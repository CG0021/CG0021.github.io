<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Thai:wght@300;400;500;600&display=swap');
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --border-color: #e2e8f0;
            --header-bg: #f1f5f9;
            --row-hover: #f8fafc;
            --success-color: #16a34a;
            --error-color: #dc2626;
            --warning-color: #f97316;
            --error-bg-soft: #fef2f2;
            --error-border-soft: #fecaca;
            --warning-bg-soft: #fff7ed;
            --warning-border-soft: #fed7aa;
        }

        body {
            font-family: 'IBM Plex Sans Thai', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            line-height: 1.5;
            position: relative; /* Add this to make absolute positioning of child elements work relative to the body */
        }

        .developer-info-top-right {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 12px;
            color: rgba(0, 0, 0, 0.7); /* Adjust color for white background */
            text-align: right;
            line-height: 1.4;
            z-index: 10;
            padding: 8px 12px; /* Similar to nav-btn */
            border-radius: 8px; /* Similar to nav-btn */
            background-color: rgba(255, 255, 255, 0.7); /* Semi-transparent white background */
            border: 1px solid rgba(0, 0, 0, 0.1); /* Light border */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); /* Subtle shadow */
            max-width: 250px; /* Constrain width to prevent it from spanning too much */
        }

        .container {
            max-width: 1400px;
            margin: 20px auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        header {
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--secondary-color);
            margin-bottom: 10px;
        }



        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .analysis-button-container {
            text-align: right;
            margin-bottom: 15px;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-family: 'Sarabun', sans-serif;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
        }

        .btn.btn-success {
            background-color: var(--success-color);
        }

        .btn.btn-success:hover {
            background-color: #15803d;
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
        }

        input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }

        .toggle-switch-container {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 40px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--primary-color);
        }

        input:checked+.slider:before {
            transform: translateX(16px);
        }

        .table-container {
            overflow-x: auto;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: right;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
            white-space: normal;
            word-break: break-word;
        }

        th {
            background: #2c3e50; /* Dark grey/blue from example */
            color: white;
            padding: 10px 6px; /* Adjusted padding from example */
            text-align: center; /* Center align headers as in example */
            font-weight: 600;
            font-size: 0.95em; /* Adjusted font size from example, slightly larger than 0.85em for readability */
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .header-fixed {
            position: fixed;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        th:first-child {
            text-align: left;
            background-color: #2c3e50;
            font-weight: 600;
            color: white;
            min-width: 150px; /* Allow shrinking but not too small */
        }
        td:first-child {
            text-align: left;
            background-color: white;
            min-width: 150px; /* Allow shrinking but not too small */
            font-weight: 500;
        }

        /* Style for tooltips */
        td.has-definition {
            cursor: help;
            border-bottom: 1px dotted #6b7280;
        }

        /* Style for validation cells */
        .cell-error {
            background-color: var(--error-bg-soft) !important;
            border: 1px solid var(--error-border-soft) !important;
            color: var(--error-color) !important;
            font-weight: 600;
        }

        .cell-warning {
            background-color: var(--warning-bg-soft) !important;
            border: 1px solid var(--warning-border-soft) !important;
            color: var(--warning-color) !important;
            font-weight: 600;
        }

        td[contenteditable="true"] {
            outline: 2px solid var(--primary-color);
            border-radius: 4px;
        }

        td[data-year] {
            white-space: nowrap; /* Prevent numbers from wrapping */
            word-break: normal; /* Override break-word */
            min-width: 100px; /* Ensure year columns have a minimum width */
        }

        .cell-modified {
            background-color: #fefce8 !important;
            color: #d97706;
            font-weight: 600;
            border: 1px solid #fcd34d !important;
        }

        .floating-save-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 2002;
            box-shadow: 0 4px 20px rgba(22, 163, 74, 0.4);
            animation: slideUp 0.3s ease-out;
            min-width: 160px;
            justify-content: center;
        }



        tr:hover td {
            background-color: var(--row-hover);
        }

        #dataTable tbody tr.clickable-row {
            cursor: pointer;
        }

        tr:hover td:first-child {
            background-color: var(--row-hover);
        }

        .indent-1 {
            padding-left: 30px !important;
        }

        .indent-2 {
            padding-left: 50px !important;
        }

        .font-bold td {
            font-weight: 700;
            background-color: #f8fafc;
        }

        /* --- Column Group Colors --- */
        /* Past 3 years - light indigo */
        td:nth-child(2),
        td:nth-child(3),
        td:nth-child(4) {
            background-color: #eef2ff;
        }

        /* Future 3 years - light green */
        td:nth-child(5),
        td:nth-child(6),
        td:n-child(7) {
            background-color: #f0fdf4;
        }

        /* --- End Column Group Colors --- */

        #status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
            color: var(--success-color);
            text-align: center;
            height: 20px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        #status.show {
            opacity: 1;
        }


        #validation-report {
            margin-top: 30px;
        }

        #validation-report h2 {
            font-size: 20px;
            color: var(--secondary-color);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
        }

        .report-item {
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .report-success {
            background-color: #f0fdf4;
            border: 1px solid #bbf7d0;
            color: #15803d;
        }

        .report-error {
            background-color: var(--error-bg-soft);
            border: 1px solid var(--error-border-soft);
            color: #b91c1c;
        }

        .report-warning {
            background-color: var(--warning-bg-soft);
            border: 1px solid var(--warning-border-soft);
            color: #c2410c;
        }

        .report-item strong {
            font-weight: 600;
        }

        .report-item u {
            text-decoration-color: var(--warning-color);
            text-decoration-thickness: 2px;
        }

        /* Modal Styles */
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-backdrop.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.95);
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 1000px;
            height: 80vh;
            /* Fixed height for taller chart */
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
        }

        .modal-content.show {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        /* Minimized State - Animate to bottom right */
        .modal-content.minimized {
            opacity: 0;
            visibility: hidden;
            top: 95%;
            left: 95%;
            transform: translate(-50%, -50%) scale(0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--secondary-color);
            margin: 0;
        }

        .window-controls {
            display: flex;
            gap: 10px;
            /* Increased gap */
        }

        .window-btn {
            background: #f1f5f9;
            /* Light background for better visibility */
            border: 1px solid var(--border-color);
            cursor: pointer;
            padding: 0;
            width: 40px;
            /* Larger fixed size */
            height: 40px;
            /* Larger fixed size */
            border-radius: 8px;
            /* Softer corners */
            color: #64748b;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .window-btn svg {
            width: 24px;
            /* Larger icons */
            height: 24px;
        }

        .window-btn:hover {
            background-color: #e2e8f0;
            color: var(--text-color);
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .window-btn.close:hover {
            background-color: #fee2e2;
            color: #ef4444;
            border-color: #fecaca;
        }

        #active-series-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 10px;
            max-height: 60px;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .series-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            background-color: #f1f5f9;
            border-radius: 16px;
            font-size: 12px;
            border: 1px solid var(--border-color);
        }

        .series-remove {
            cursor: pointer;
            color: #94a3b8;
            display: flex;
            align-items: center;
        }

        .series-remove:hover {
            color: #ef4444;
        }

        .chart-container {
            flex-grow: 1;
            position: relative;
            min-height: 0;
            width: 100%;
        }

        /* Active Row Style */
        tr.row-active td {
            background-color: #e0e7ff !important;
            border-top: 1px solid #818cf8;
            border-bottom: 1px solid #818cf8;
        }

        tr.row-active td:first-child {
            border-left: 4px solid #4f46e5;
            font-weight: 700;
            color: #4338ca;
            position: relative;
        }

        tr.row-active td:first-child::after {
            content: "üìä";
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
        }

        /* Floating Restore Button */
        #restore-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: var(--primary-color);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            box-shadow: 0 4px 20px rgba(37, 99, 235, 0.5);
            border: none;
            cursor: pointer;
            z-index: 2001;
            display: none;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s;
            animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #restore-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(37, 99, 235, 0.6);
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .chart-container {
            flex-grow: 1;
            position: relative;
            min-height: 0;
            /* Important for flex child scroll/resize */
        }

        .cell-analysis-warning {
            background-color: #fef9c3 !important;
            color: #ca8a04 !important;
        }
    </style>
</head>

<body>
    <div class="developer-info-top-right">
        ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÇ‡∏î‡∏¢ ‡∏î‡∏£.‡∏ô‡∏û.‡∏ä‡∏∏‡∏°‡∏û‡∏• ‡∏ô‡∏∏‡∏ä‡∏ú‡πà‡∏≠‡∏á<br>‡∏ô‡∏≤‡∏¢‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç ‡πÄ‡∏ß‡∏ä‡∏Å‡∏£‡∏£‡∏°‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô<br>‡∏Å‡∏≠‡∏á‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏±‡∏Å‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û<br>‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏õ‡∏•‡∏±‡∏î‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç
    </div>

    <div class="container">
        <header>
            <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏ú‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á</h1>
            <p>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏ü‡∏•‡πå Excel ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á 3 ‡∏õ‡∏µ ‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô 3 ‡∏õ‡∏µ‡∏´‡∏ô‡πâ‡∏≤</p>

        </header>

        <div class="controls">
            <div class="file-input-wrapper">
                <button class="btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Excel
                </button>
                <input type="file" id="excelFile" accept=".xlsx, .xls" onchange="handleFile(this)">
            </div>
            <button class="btn btn-outline" onclick="downloadTemplate()">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö
            </button>
            <button id="editDataBtn" class="btn btn-outline" onclick="toggleEditMode()">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="feather feather-edit-2">
                    <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
                </svg>
                ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </button>

            <div class="toggle-switch-container">
                <label class="toggle-switch">
                    <input type="checkbox" id="formatNumberToggle" onchange="toggleNumberFormatting(this.checked)" checked>
                    <span class="slider"></span>
                </label>
                <label for="formatNumberToggle" style="cursor: pointer;">‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏•‡∏Ç‡∏¢‡πà‡∏≠ (M/K)</label>
            </div>
        </div>
        <div id="status"></div>

        <div class="analysis-button-container">
            <button id="analyzePlanBtn" class="btn btn-outline" onclick="analyzePlan()">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-bar-chart-2"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>
                ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏ú‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á
            </button>
        </div>

        <div class="table-container">
            <table id="dataTable">
                <thead>
                    <tr>
                        <!-- Headers will be generated dynamically -->
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Rows will be generated here -->
                </tbody>
            </table>
        </div>
    </div>

    <div id="validation-report" class="container" style="display: none;">
        <h2>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
        <div id="report-content"></div>
    </div>

    <!-- Modal for Chart -->
    <div id="chartBackdrop" class="modal-backdrop"></div>
    <div id="chartModal" class="modal-content">
        <div class="modal-header">
            <h2 id="chart-title" class="modal-title">‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°</h2>
            <div class="window-controls">
                <div class="toggle-switch-container" style="margin-right: 15px;">
                    <label class="toggle-switch">
                        <input type="checkbox" id="stackChartToggle" onchange="updateChart()">
                        <span class="slider"></span>
                    </label>
                    <label for="stackChartToggle" style="cursor: pointer;">‡∏ã‡πâ‡∏≠‡∏ô‡∏Å‡∏£‡∏≤‡∏ü</label>
                </div>
                <div class="toggle-switch-container" style="margin-right: 15px;">
                    <label class="toggle-switch">
                        <input type="checkbox" id="showPercentageToggle" onchange="updateChart()" checked>
                        <span class="slider"></span>
                    </label>
                    <label for="showPercentageToggle" style="cursor: pointer;">‡πÅ‡∏™‡∏î‡∏á %</label>
                </div>
                <button class="window-btn" onclick="toggleMinimize()" title="‡∏¢‡πà‡∏≠/‡∏Ç‡∏¢‡∏≤‡∏¢">
                    <svg id="minimize-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <polyline points="4 14 10 14 10 20"></polyline>
                        <polyline points="20 10 14 10 14 4"></polyline>
                        <line x1="14" y1="10" x2="21" y2="3"></line>
                        <line x1="3" y1="21" x2="10" y2="14"></line>
                    </svg>
                </button>
                <button class="window-btn close" onclick="closeChart()" title="‡∏õ‡∏¥‡∏î">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
        </div>
        <div id="active-series-container"></div>
        <div class="chart-container">
            <canvas id="trendChart"></canvas>
        </div>
    </div>


    <!-- Restore Button -->
    <button id="restore-btn" onclick="toggleMinimize()">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="15 3 21 3 21 9"></polyline>
            <polyline points="9 21 3 21 3 15"></polyline>
            <line x1="21" y1="3" x2="14" y2="10"></line>
            <line x1="3" y1="21" x2="10" y2="14"></line>
        </svg>
        ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü
    </button>

    <script>
        let years = ["2566", "2567", "2568", "2569", "2570", "2571"]; // Default years

        const tableStructure = [
            // --- ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö ---
            { id: "header_revenue", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö", level: 0, bold: true, isHeader: true },
            { id: "header_op_revenue", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô", level: 1, bold: true, isHeader: true },
            { id: "rev_uc", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ñ‡πâ‡∏ß‡∏ô‡∏´‡∏ô‡πâ‡∏≤ UC", level: 2, sumGroup: ["total_revenue"], isEditable: true, definition: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏à‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏´‡∏±‡∏ß UC OP/PP, IP, ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏à‡∏≤‡∏Å‡∏™‡∏õ‡∏™‡∏ä., ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ UC (‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á ‡∏£‡∏û.‡∏™‡∏ï.)" },
            { id: "rev_uc_invest", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ñ‡πâ‡∏ß‡∏ô‡∏´‡∏ô‡πâ‡∏≤ UC ‡∏á‡∏ö‡∏•‡∏á‡∏ó‡∏∏‡∏ô", level: 2, sumGroup: ["total_revenue"], isEditable: true },
            { id: "rev_ems", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô (EMS)", level: 2, sumGroup: ["total_revenue"], isEditable: true, definition: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£ EMS ‡∏à‡∏≤‡∏Å ‡∏™‡∏û‡∏â." },
            { id: "rev_direct_claim", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏£‡∏á‡∏Å‡∏£‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Å‡∏•‡∏≤‡∏á", level: 2, sumGroup: ["total_revenue"], isEditable: true, definition: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏à‡∏≤‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏£‡∏°‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Å‡∏•‡∏≤‡∏á" },
            { id: "rev_reimburse", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡πÄ‡∏ö‡∏¥‡∏Å‡∏ï‡πâ‡∏ô‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î", level: 2, sumGroup: ["total_revenue"], isEditable: true, definition: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏à‡∏≤‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê ‡∏£‡∏±‡∏ê‡∏ß‡∏¥‡∏™‡∏≤‡∏´‡∏Å‡∏¥‡∏à ‡∏à‡∏≤‡∏Å‡∏ï‡πâ‡∏ô‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î ‡πÄ‡∏ä‡πà‡∏ô ‡∏Å‡∏ü‡∏†. ‡∏Å‡∏ü‡∏ù. ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏õ‡∏≤ ‡∏£‡∏ü‡∏ó. ‡∏Å‡∏™‡∏Å‡∏ä. ‡∏ö‡∏°‡∏à.‡πÇ‡∏ó‡∏£‡∏Ñ‡∏°‡∏ô‡∏≤‡∏Ñ‡∏°‡πÅ‡∏´‡πà‡∏á‡∏ä‡∏≤‡∏ï‡∏¥" },
            { id: "rev_local_gov", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡∏≤‡∏Å ‡∏≠‡∏õ‡∏ó.", level: 2, sumGroup: ["total_revenue"], isEditable: true, definition: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏£‡∏á ‡∏≠‡∏õ‡∏ó. (‡∏≠‡∏ö‡∏ï. ‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏• ‡∏≠‡∏ö‡∏à. ‡∏Å‡∏ó‡∏°. ‡πÅ‡∏•‡∏∞‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏û‡∏±‡∏ó‡∏¢‡∏≤)" },
            { id: "rev_social_security", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏±‡∏á‡∏Ñ‡∏°", level: 2, sumGroup: ["total_revenue"], isEditable: true, definition: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏´‡∏±‡∏ß OP/IP, ‡∏†‡∏≤‡∏£‡∏∞‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÇ‡∏£‡∏Ñ‡πÄ‡∏£‡∏∑‡πâ‡∏≠‡∏£‡∏±‡∏á, HA, ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏à‡∏≤‡∏Å‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏õ‡∏Å‡∏™., ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ ‡∏õ‡∏Å‡∏™." },
            { id: "rev_foreign_worker", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ß", level: 2, sumGroup: ["total_revenue"], isEditable: true, definition: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ø (‡∏ö‡∏±‡∏ï‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û) ‡∏Ñ‡πà‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ñ‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ß‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ß, ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 30 ‡∏ö‡∏≤‡∏ó, ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ ‡∏Ñ‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ß‡πÅ‡∏•‡∏∞‡πÅ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ß" },
            { id: "rev_other_service", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô", level: 2, sumGroup: ["total_revenue"], isEditable: true, definition: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏à‡∏≤‡∏Å‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô, ‡∏û‡∏£‡∏ö., ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥,‡∏Ñ‡πà‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å, ‡∏Ñ‡πà‡∏≤‡∏™‡∏¥‡πà‡∏á‡∏™‡πà‡∏á‡∏ï‡∏£‡∏ß‡∏à, ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå, ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° UC, ‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô‡πÜ" },
            { id: "header_other_revenue", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏≠‡∏∑‡πà‡∏ô‡πÜ", level: 1, bold: true, isHeader: true },
            { id: "rev_aid", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠", level: 2, sumGroup: ["total_revenue"], isEditable: true, definition: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏î‡∏¢‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏à‡∏à‡∏≤‡∏Å‡∏£‡∏±‡∏ê‡∏ö‡∏≤‡∏•‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏® ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®" },
            { id: "rev_subsidy", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô", level: 2, sumGroup: ["total_revenue"], isEditable: true, definition: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∏‡∏ô ‡∏à‡∏≤‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê (‡πÄ‡∏ä‡πà‡∏ô ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ã‡∏∑‡πâ‡∏≠‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏Ø‡∏à‡∏≤‡∏Å‡∏Å‡∏£‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏î‡πÅ‡∏ó‡∏ô‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏£‡∏±‡∏Å‡∏©‡πå‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô,‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡∏à‡∏≤‡∏Å‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á‡∏™‡πà‡∏ß‡∏ô‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô, ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡∏à‡∏≤‡∏Å‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÉ‡∏ô‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡∏£‡∏±‡∏ê" },
            { id: "rev_donation", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ", level: 2, sumGroup: ["total_revenue"], isEditable: true, definition: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏á‡∏¥‡∏ô‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ò‡∏£‡∏£‡∏°‡∏î‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡∏†‡∏≤‡∏Ñ‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô ‡πÇ‡∏î‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏à ‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏´‡∏≤‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå, ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡∏à‡∏≤‡∏Å‡∏°‡∏´‡∏≤‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏•‡∏±‡∏¢‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô)" },
            { id: "rev_interest", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£", level: 2, sumGroup: ["total_revenue"], isEditable: true, definition: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏î‡∏≠‡∏Å‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£ ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á ‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏≠‡∏Å‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏≠‡∏∑‡πà‡∏ô ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ô‡∏≥‡∏™‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô" },
            { id: "rev_other", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏≠‡∏∑‡πà‡∏ô", level: 2, sumGroup: ["total_revenue"], isEditable: true, definition: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏à‡∏≤‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î‡∏™‡∏õ.‡∏™‡∏ò. ‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡∏Å‡∏•‡∏á (‡πÄ‡∏Ç‡∏ï ‡∏™‡∏™‡∏à. ‡∏£‡∏û‡∏®.‡∏£‡∏û‡∏ó. ‡∏£‡∏û‡∏ä. ‡∏£‡∏û.‡∏™‡∏ï), ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á ‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏î‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö ‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏™‡∏±‡∏ç‡∏ç‡∏≤ ‡∏Ñ‡πà‡∏≤‡∏Ç‡∏≤‡∏¢‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå ‡∏™‡∏¥‡πà‡∏á‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á ‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô / ‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥ / ‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏±‡∏ö‡∏ù‡∏≤‡∏Å‡∏≠‡∏∑‡πà‡∏ô ‡∏Ø" },
            { id: "total_revenue", name: "‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö", level: 0, bold: true, totalFor: "total_revenue" },

            // --- ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢ ---
            { id: "header_expense", name: "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢", level: 0, bold: true, isHeader: true },
            { id: "header_personnel_exp", name: "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£", level: 1, bold: true, isHeader: true },
            { id: "exp_temp_employee", name: "‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡∏•‡∏π‡∏Å‡∏à‡πâ‡∏≤‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß / ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡πÑ‡∏î‡πâ‡πÅ‡∏Å‡πà ‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏£‡∏≤‡∏¢‡∏Ñ‡∏≤‡∏ö ‡∏û‡∏Å‡∏™. ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£" },
            { id: "exp_ot_service", name: "‡∏Ñ‡πà‡∏≤‡∏•‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏á‡∏≤‡∏ô‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ / ‡∏á‡∏≤‡∏ô‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö ‡∏Å‡∏£‡∏∞‡∏ó‡∏£‡∏ß‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏±‡∏á ‡∏õ‡∏µ ‡∏û.‡∏®. 2550" },
            { id: "exp_night_shift", name: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡πÄ‡∏ß‡∏£‡∏ú‡∏•‡∏±‡∏î‡∏ö‡πà‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏•‡∏±‡∏î‡∏î‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏£‡∏ú‡∏•‡∏±‡∏î‡∏ö‡πà‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏•‡∏±‡∏î‡∏î‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• ‡πÅ‡∏•‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô ‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Ø ‡∏û.‡∏®. 2566" },
            { id: "exp_no_private_practice", name: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÄ‡∏ß‡∏ä‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô ‡∏£‡∏û.‡πÄ‡∏≠‡∏Å‡∏ä‡∏ô", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÄ‡∏ß‡∏ä‡∏Ç‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡∏ó‡∏±‡∏ô‡∏ï‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£ ‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Ø ‡∏û.‡∏®. 2566" },
            { id: "exp_allowance_11", name: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πà‡∏≤‡∏¢ (‡∏â.11)", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πà‡∏≤‡∏¢ ‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå ‡∏Ø ‡∏û.‡∏®. 2566" },
            { id: "exp_performance_12", name: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô (‡∏â.12)", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô ‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå ‡∏Ø ‡∏û.‡∏®. 2566" },
            { id: "exp_pts", name: "‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏û.‡∏ï.‡∏™)", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏û‡∏ï‡∏™.) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡∏ó‡∏±‡∏ô‡∏ï‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡πÄ‡∏†‡∏™‡∏±‡∏ä ‡πÅ‡∏•‡∏∞‡∏™‡∏´‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û 7 ‡∏™‡∏≤‡∏Ç‡∏≤" },
            { id: "exp_ot_5", name: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà (‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤) ‡∏â5", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà ‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå ‡∏Ø ‡∏û.‡∏®. 2566" },
            { id: "exp_smc", name: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ (SMC)", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ô‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ ‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Ø ‡∏û.‡∏®. 2566" },
            { id: "exp_other_comp", name: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏≠‡∏∑‡πà‡∏ô", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏ä‡∏±‡∏ô‡∏™‡∏π‡∏ï‡∏£‡∏û‡∏•‡∏¥‡∏Å‡∏®‡∏û, ‡∏™‡∏≤‡∏Ç‡∏≤‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©, ‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏ä‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥ ‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ" },
            { id: "exp_other_personnel", name: "‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏≠‡∏∑‡πà‡∏ô", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏ó‡∏ö‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏õ‡∏Å‡∏™.‡∏™‡πà‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏ô‡∏≤‡∏¢‡∏à‡πâ‡∏≤‡∏á ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏ó‡∏ö‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏™‡∏≥‡∏£‡∏≠‡∏á‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏ä‡∏µ‡∏û‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ê (‡∏û‡∏Å‡∏™.) ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏ó‡∏ö‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏ó‡∏î‡πÅ‡∏ó‡∏ô ‡∏õ‡∏Å‡∏™. ‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï (‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏≠‡∏Å‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)" },
            { id: "exp_allowance_10", name: "‡∏Ñ‡πà‡∏≤‡∏ï‡∏≠‡∏ö‡πÅ‡∏ó‡∏ô‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏à‡πà‡∏≤‡∏¢ (‡∏â.10)", level: 2, sumGroup: ["total_expense"], isEditable: true },

            { id: "header_op_expense", name: "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô", level: 1, bold: true, isHeader: true, definition: "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô" },
            { id: "exp_medicine", name: "‡∏Ñ‡πà‡∏≤‡∏¢‡∏≤", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏¢‡∏≤ (‡∏à‡∏≤‡∏Å‡πÅ‡∏ú‡∏ô‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ ‡∏ä‡πà‡∏≠‡∏á [7] ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏ä‡∏≥‡∏£‡∏∞‡∏õ‡∏µ 25xx ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏≠‡∏Å‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)" },
            { id: "exp_non_medicine_supplies", name: "‡πÄ‡∏ß‡∏ä‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏°‡∏¥‡πÉ‡∏ä‡πà‡∏¢‡∏≤", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå /‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå/ ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏†‡∏™‡∏±‡∏ä /‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏° /‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏≠‡πä‡∏Å‡∏ã‡πÄ‡∏£‡∏¢‡πå (‡∏à‡∏≤‡∏Å‡πÅ‡∏ú‡∏ô‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ ‡∏ä‡πà‡∏≠‡∏á [7] ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏ä‡∏≥‡∏£‡∏∞‡∏õ‡∏µ 25xx ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏≠‡∏Å‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)" },
            { id: "exp_medical_supplies", name: "‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå", level: 2, sumGroup: ["total_expense"], isEditable: true },
            { id: "exp_lab_supplies", name: "‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå", level: 2, sumGroup: ["total_expense"], isEditable: true },
            { id: "exp_pharma_supplies", name: "‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏†‡∏™‡∏±‡∏ä", level: 2, sumGroup: ["total_expense"], isEditable: true },
            { id: "exp_dental_supplies", name: "‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ó‡∏±‡∏ô‡∏ï‡∏Å‡∏£‡∏£‡∏°", level: 2, sumGroup: ["total_expense"], isEditable: true },
            { id: "exp_xray_supplies", name: "‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏≠‡πá‡∏Å‡∏ã‡πÄ‡∏£‡∏¢‡πå", level: 2, sumGroup: ["total_expense"], isEditable: true },
            { id: "exp_materials", name: "‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏™‡∏î‡∏∏", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏ö‡∏£‡∏¥‡πÇ‡∏†‡∏Ñ ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢ ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏¢‡∏≤‡∏ô‡∏û‡∏≤‡∏´‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏Ç‡∏ô‡∏™‡πà‡∏á ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏¥‡∏á‡πÅ‡∏•‡∏∞‡∏´‡∏•‡πà‡∏≠‡∏•‡∏∑‡πà‡∏ô ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡∏∏ ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏ú‡∏¢‡πÅ‡∏û‡∏£‡πà ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏á‡∏≤‡∏ô‡∏ö‡πâ‡∏≤‡∏ô‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡∏ß ‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏™‡∏î‡∏∏‡∏≠‡∏∑‡πà‡∏ô (‡∏à‡∏≤‡∏Å‡πÅ‡∏ú‡∏ô‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡∏µ‡πâ ‡∏ä‡πà‡∏≠‡∏á [7] ‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏ä‡∏≥‡∏£‡∏∞‡∏õ‡∏µ 25xx ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏ô‡∏≠‡∏Å‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì)" },
            { id: "exp_utilities", name: "‡∏Ñ‡πà‡∏≤‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏π‡∏õ‡πÇ‡∏†‡∏Ñ", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ ‡∏ô‡πâ‡∏≥‡∏õ‡∏£‡∏∞‡∏õ‡∏≤ ‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÑ‡∏õ‡∏£‡∏©‡∏ì‡∏µ‡∏¢‡πå ‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏¥‡∏ô‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï ‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡πÄ‡∏Ñ‡πÄ‡∏ö‡∏¥‡πâ‡∏•‡∏ó‡∏µ‡∏ß‡∏µ" },
            { id: "exp_sundry", name: "‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏™‡∏≠‡∏¢", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ ‡∏ù‡∏∂‡∏Å‡∏≠‡∏ö‡∏£‡∏°, ‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏≤ ‡∏Ñ‡πà‡∏≤‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°‡∏Ñ‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå, ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå, ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏†‡∏±‡∏¢, ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£" },
            { id: "exp_other_op", name: "‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ ‡∏ï‡∏≤‡∏°‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏Ø ‡πÄ‡∏ä‡πà‡∏ô PP UC , ‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ß, ‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥" },

            { id: "header_invest_expense", name: "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏•‡∏á‡∏ó‡∏∏‡∏ô", level: 1, bold: true, isHeader: true },
            { id: "exp_equipment", name: "‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå", level: 2, isHeader: true },
            { id: "exp_equip_depreciation", name: "‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏á‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô UC ‡∏á‡∏ö‡∏•‡∏á‡∏ó‡∏∏‡∏ô" },
            { id: "exp_equip_donation", name: "‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ" },
            { id: "exp_equip_maintenance", name: "‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏£‡∏∏‡∏†‡∏±‡∏ì‡∏ë‡πå‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£" },
            
            { id: "exp_land_building", name: "‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á", level: 2, isHeader: true },

            
            { id: "exp_lb_depreciation", name: "‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏á‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô UC ‡∏á‡∏ö‡∏•‡∏á‡∏ó‡∏∏‡∏ô" },
            { id: "exp_lb_donation", name: "‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏£‡∏¥‡∏à‡∏≤‡∏Ñ" },
            { id: "exp_lb_maintenance", name: "‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡πà‡∏á‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏¥‡πà‡∏á‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á ‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏¥‡∏Å‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£" },

            { id: "header_other_expense", name: "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô", level: 1, bold: true, isHeader: true },
            { id: "exp_support_other_hospitals", name: "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô ‡∏£‡∏û.‡∏™‡∏ï. ‡∏£‡∏û‡∏ä. ‡∏£‡∏û‡∏ó. ‡∏£‡∏û‡∏®. ‡∏™‡∏™‡∏≠. ‡∏™‡∏™‡∏à.", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏™‡∏±‡∏á‡∏Å‡∏±‡∏î‡∏™‡∏õ.‡∏™‡∏ò. ‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏ï‡∏Å‡∏•‡∏á‡∏Ø (‡∏™‡∏™‡∏≠. ‡∏™‡∏™‡∏à.‡∏£‡∏û‡∏®. ‡∏£‡∏û‡∏ó. ‡∏£‡∏û‡∏ä. ‡∏£‡∏û.‡∏™‡∏ï.) ‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô ‡∏£‡∏û.‡∏™‡∏ï. ‡πÄ‡∏ä‡πà‡∏ô ‡∏á‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏° Fixed cost" },
            { id: "exp_misc", name: "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏∑‡πà‡∏ô‡πÜ", level: 2, sumGroup: ["total_expense"], isEditable: true, definition: "‡πÄ‡∏ä‡πà‡∏ô ‡∏ï‡∏≤‡∏°‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡πà‡∏≤‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏• UC ‡∏ï‡πà‡∏≤‡∏á‡∏î‡πâ‡∏≤‡∏ß ‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏•‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥ ‡∏õ‡∏Å‡∏™. , ‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏™‡∏≤‡∏ò‡∏≤‡∏£‡∏ì‡∏™‡∏∏‡∏Ç‡∏Ø (‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏Ø ‡∏Ç‡πâ‡∏≠ 9 (10) , ‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏™‡∏≤‡∏Ç‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤‡∏ä‡∏µ‡∏û‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡πÅ‡∏Ñ‡∏•‡∏ô (‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏Ø ‡∏Ç‡πâ‡∏≠ 9 (11) , ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏¥‡∏ï‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÅ‡∏•‡∏∞‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå , ‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô / ‡πÄ‡∏á‡∏¥‡∏ô‡∏°‡∏±‡∏î‡∏à‡∏≥ / ‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏±‡∏ö‡∏ù‡∏≤‡∏Å‡∏≠‡∏∑‡πà‡∏ô ‡∏Ø" },
            { id: "exp_central_fund", name: "‡∏á‡∏ö‡∏Å‡∏•‡∏≤‡∏á (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 2-3.5 ‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢)", level: 1, sumGroup: ["total_expense"], isEditable: true, definition: "‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏à‡∏≤‡∏Å‡∏Å‡∏£‡∏ì‡∏µ‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô ‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô ‡∏ï‡∏≤‡∏°‡∏ô‡πÇ‡∏¢‡∏ö‡∏≤‡∏¢‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£ ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏£‡πâ‡∏≠‡∏¢‡∏•‡∏∞ 2-3.5 ‡∏Ç‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢" },
            { id: "total_expense", name: "‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢", level: 0, bold: true, totalFor: "total_expense" },

            { id: "net_income", name: "‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏™‡∏π‡∏á (‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤) ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏∏‡∏ó‡∏ò‡∏¥", level: 0, bold: true },
            { id: "brought_forward", name: "‡∏ö‡∏ß‡∏Å‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏™‡∏∞‡∏™‡∏°‡∏¢‡∏Å‡∏°‡∏≤", level: 0, isEditable: true },
            { id: "total_balance_1", name: "‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô (1)", level: 0, bold: true },
            { id: "fund_to_allocate", name: "‡∏Å‡∏≠‡∏á‡∏ó‡∏∏‡∏ô‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡∏£‡∏£ (4)", level: 0, isEditable: true },
            { id: "commitments", name: "‡∏†‡∏≤‡∏£‡∏∞‡∏ú‡∏π‡∏Å‡∏û‡∏±‡∏ô (5)", level: 0, isEditable: true },
            { id: "committed_goods", name: "‡∏´‡∏±‡∏Å‡∏Å‡πà‡∏≠‡∏´‡∏ô‡∏µ‡πâ‡∏†‡∏≤‡∏£‡∏∞‡∏ú‡∏π‡∏Å‡∏û‡∏±‡∏ô‡∏û‡∏±‡∏™‡∏î‡∏∏ (6)", level: 0, isEditable: true },
            { id: "balance_after_deductions", name: "‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏´‡∏±‡∏Å‡∏ï‡∏≤‡∏° ‡∏Ç‡πâ‡∏≠ (4) ‡πÅ‡∏•‡∏∞ ‡∏Ç‡πâ‡∏≠ (5) ‡∏Ç‡πâ‡∏≠ (6)", level: 0, bold: true },

            { id: "header_balance_breakdown", name: "‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô ‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢", level: 0, bold: true, isHeader: true },
            { id: "cash_equivalent", name: "‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î/‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡πà‡∏≤‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î", level: 1, sumGroup: ["total_balance_2"], isEditable: true },
            { id: "treasury_deposit", name: "‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á", level: 1, sumGroup: ["total_balance_2"], isEditable: true },
            { id: "bank_deposit", name: "‡πÄ‡∏á‡∏¥‡∏ô‡∏ù‡∏≤‡∏Å‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£", level: 1, bold: true, isHeader: true },
            { id: "fixed_deposit", name: "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏õ‡∏£‡∏∞‡∏à‡∏≥", level: 2, sumGroup: ["total_balance_2"], isEditable: true },
            { id: "savings_deposit", name: "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏≠‡∏°‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå", level: 2, sumGroup: ["total_balance_2"], isEditable: true },
            { id: "current_deposit", name: "‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏£‡∏∞‡πÅ‡∏™‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô", level: 2, sumGroup: ["total_balance_2"], isEditable: true },
            { id: "total_balance_2", name: "‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô (2)", level: 0, bold: true, totalFor: "total_balance_2" }
        ];

        const emptyRowItems = tableStructure
            .filter(item => item.isHeader)
            .map(item => item.name);

        let trendChart = null;
        let activeDatasets = []; // Store data for multiple series
        let isChartMinimized = false;
        const chartColors = [
            '#2563eb', '#dc2626', '#16a34a', '#d97706', '#9333ea', '#0891b2', '#db2777'
        ];

        let isEditMode = false;
        let hasUnsavedChanges = false;


        function formatNumber(num, isFormattingToggled) {
            if (num === null || num === undefined || isNaN(num)) return '-';

            if (isFormattingToggled) {
                if (Math.abs(num) >= 1_000_000) {
                    return (num / 1_000_000).toFixed(1) + 'M';
                }
                if (Math.abs(num) >= 100_000) {
                    return (num / 1_000).toFixed(0) + 'K';
                }
            }

            return num.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }



        function toggleNumberFormatting(isToggled) {
            document.querySelectorAll('#tableBody td[data-original-value]').forEach(cell => {
                const originalValue = parseFloat(cell.dataset.originalValue);
                cell.textContent = formatNumber(originalValue, isToggled);
            });
        }



        function updateTableHeader() {
            const thead = document.querySelector('#dataTable thead tr');
            thead.innerHTML = '<th>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>';
            years.forEach(year => {
                const th = document.createElement('th');
                th.textContent = year;
                thead.appendChild(th);
            });
        }

        function initTable() {
            updateTableHeader();
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            tableStructure.forEach(item => {
                const tr = document.createElement('tr');
                tr.dataset.id = item.id;
                if (item.bold) tr.className = 'font-bold';

                // Only allow rows with data to be clickable for charts
                if (item.isEditable || (item.sumGroup && !item.totalFor)) {
                    tr.classList.add('clickable-row');
                }

                const tdName = document.createElement('td');
                tdName.textContent = item.name;
                if (item.level > 0) tdName.classList.add(`indent-${item.level}`);

                if (item.definition) {
                    tdName.title = item.definition;
                    tdName.classList.add('has-definition');
                }

                tr.appendChild(tdName);
                years.forEach(year => {
                    const td = document.createElement('td');
                    td.dataset.year = year;
                    td.dataset.itemId = item.id;
                    td.textContent = (emptyRowItems.includes(item.name)) ? "" : "-";
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
        }



        function handleFile(input) {
            const file = input.files[0];
            if (!file) return;

            if (isEditMode) {
                if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                    input.value = ''; // Reset file input
                    return;
                }
                toggleEditMode(true); // Exit edit mode without saving
            }

            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('validation-report').style.display = 'none';
                document.getElementById('report-content').innerHTML = '';
                document.querySelectorAll('.cell-error, .cell-warning').forEach(cell => {
                    cell.classList.remove('cell-error', 'cell-warning');
                });

                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, raw: false });

                processData(jsonData);
                recalculateAndUpdate();
                validateData();

                const statusEl = document.getElementById('status');
                statusEl.textContent = `‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${file.name}. ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•`;
                statusEl.classList.add('show');
                setTimeout(() => statusEl.classList.remove('show'), 5000);
            };
            reader.readAsArrayBuffer(file);
        }



        function processData(rows) {
            // 1. Find Header Row
            let headerRowIndex = -1;
            let foundYears = [];

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                if (!row) continue;

                // Extract potential years from the row
                const potentialYears = row.map(cell => {
                    if (!cell) return null;
                    const str = cell.toString().trim();
                    const match = str.match(/\d{4}/);
                    return match ? parseInt(match[0]) : null;
                });

                // Check for sequence of 6 years
                let sequenceCount = 0;
                let startYear = -1;
                let tempYears = [];

                for (let j = 0; j < potentialYears.length; j++) {
                    if (potentialYears[j]) {
                        if (startYear === -1) {
                            startYear = potentialYears[j];
                            sequenceCount = 1;
                            tempYears = [row[j].toString().trim()];
                        } else {
                            if (potentialYears[j] === startYear + sequenceCount) {
                                sequenceCount++;
                                tempYears.push(row[j].toString().trim());
                            } else {
                                // Reset if sequence breaks, but check if this new number starts a new sequence
                                startYear = potentialYears[j];
                                sequenceCount = 1;
                                tempYears = [row[j].toString().trim()];
                            }
                        }
                    }

                    if (sequenceCount === 6) {
                        headerRowIndex = i;
                        foundYears = tempYears;
                        break;
                    }
                }
                if (headerRowIndex !== -1) break;
            }

            if (headerRowIndex === -1) {
                alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏´‡∏£‡∏∑‡∏≠‡∏õ‡∏µ‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏£‡∏ö 6 ‡∏õ‡∏µ (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 2565, 2566, 2567, ‡πÅ‡∏ú‡∏ô 2568, ...)");
                return;
            }

            // Update Global Years
            years = foundYears;
            updateTableHeader();
            initTable(); // Re-init table with new years

            // Map Columns
            const colMap = {};
            const headerRow = rows[headerRowIndex];
            headerRow.forEach((cell, index) => {
                if (cell) {
                    const strVal = cell.toString().trim();
                    if (years.includes(strVal)) colMap[strVal] = index;
                    else if (strVal.includes("‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£")) colMap["item"] = index;
                }
            });
            if (colMap["item"] === undefined) colMap["item"] = 0;

            const uploadedData = {};
            for (let i = headerRowIndex + 1; i < rows.length; i++) {
                const row = rows[i];
                // Use the column index for "item" to get the key
                const itemName = row[colMap["item"]];
                if (itemName) {
                    uploadedData[itemName.toString().trim()] = row;
                }
            }

            const isFormattingToggled = document.getElementById('formatNumberToggle').checked;
            const tbody = document.getElementById('tableBody');
            tableStructure.forEach(item => {
                const tr = tbody.querySelector(`tr[data-id='${item.id}']`);
                if (!tr) return;

                if (item.isHeader) {
                    years.forEach((year, index) => {
                        const cell = tr.cells[index + 1];
                        cell.textContent = "";
                        cell.dataset.originalValue = 0;
                        cell.classList.remove('cell-modified');
                    });
                    return;
                }

                const matchRow = uploadedData[item.name];
                years.forEach((year, index) => {
                    const cell = tr.cells[index + 1]; // +1 because first col is name
                    let numericValue = 0;
                    if (matchRow) {
                        // Find the column index for this specific year string
                        const colIndex = colMap[year];
                        if (colIndex !== undefined) {
                            const rawValue = matchRow[colIndex];
                            if (rawValue !== undefined && rawValue !== null && rawValue !== "") {
                                numericValue = parseFloatFromStr(rawValue);
                            }
                        }
                    }
                    cell.dataset.originalValue = numericValue;
                    cell.textContent = formatNumber(numericValue, isFormattingToggled);
                    cell.classList.remove('cell-modified'); // Reset modified status on new import
                });
            });
        }



        function parseFloatFromStr(str) {
            if (str === null || str === undefined || str === "-") return 0;
            if (typeof str !== 'string') str = String(str);
            const num = parseFloat(str.replace(/,/g, '').replace(/M/g, '000000').replace(/K/g, '000'));
            return isNaN(num) ? 0 : num;
        }

        function recalculateAndUpdate() {
            const dataById = {};
            const isFormattingToggled = document.getElementById('formatNumberToggle').checked;

            // First pass: Read all current values from the DOM
            document.querySelectorAll('#tableBody tr').forEach(tr => {
                const id = tr.dataset.id;
                if (!id) return;
                dataById[id] = {};
                tr.querySelectorAll('td[data-year]').forEach(td => {
                    dataById[id][td.dataset.year] = parseFloatFromStr(td.dataset.originalValue);
                });
            });

            // Second pass: Calculate and update totals
            years.forEach((year, yearIndex) => {
                // Sum totals
                tableStructure.filter(item => item.totalFor).forEach(totalItem => {
                    const sumGroup = totalItem.totalFor;
                    let calculatedSum = 0;
                    tableStructure.filter(item => item.sumGroup && item.sumGroup.includes(sumGroup)).forEach(sumItem => {
                        calculatedSum += dataById[sumItem.id][year];
                    });
                    dataById[totalItem.id][year] = calculatedSum;
                });

                // Calculate Net Income
                dataById['net_income'][year] = dataById['total_revenue'][year] - dataById['total_expense'][year];

                // Brought Forward from previous year
                if (yearIndex > 0) {
                    const prevYear = years[yearIndex - 1];
                    dataById['brought_forward'][year] = dataById['total_balance_1'][prevYear];
                }

                // Total Balance 1
                dataById['total_balance_1'][year] = dataById['net_income'][year] + dataById['brought_forward'][year];

                // Balance After Deductions
                dataById['balance_after_deductions'][year] = dataById['total_balance_1'][year] - dataById['fund_to_allocate'][year] - dataById['commitments'][year] - dataById['committed_goods'][year];
            });

            // Final pass: Update the DOM with new values
            tableStructure.forEach(item => {
                if (item.isHeader) return;
                const tr = document.querySelector(`#tableBody tr[data-id='${item.id}']`);
                if (!tr) return;

                years.forEach(year => {
                    const cell = tr.querySelector(`td[data-year='${year}']`);
                    const newValue = dataById[item.id][year];
                    cell.dataset.originalValue = newValue;

                    // Only update text content if it's NOT the active element to prevent cursor jumping
                    if (document.activeElement !== cell) {
                        cell.textContent = formatNumber(newValue, isFormattingToggled);
                    }
                });
            });
            hasUnsavedChanges = true;
            validateData(); // Re-run validation after every calculation
        }



        function validateData() {
            const reportContainer = document.getElementById('validation-report');
            const reportContent = document.getElementById('report-content');
            document.querySelectorAll('.cell-error, .cell-warning').forEach(cell => cell.classList.remove('cell-error', 'cell-warning'));
            reportContent.innerHTML = '';

            let errors = [];
            let warnings = [];
            const dataById = {};

            document.querySelectorAll('#tableBody tr').forEach(tr => {
                const id = tr.dataset.id;
                if (!id) return;
                dataById[id] = {};
                tr.querySelectorAll('td[data-year]').forEach(td => {
                    dataById[id][td.dataset.year] = parseFloatFromStr(td.dataset.originalValue);
                });
            });

            years.forEach(year => {
                // Check 1: Total Balance (1) vs Total Balance (2)
                const totalBalance1 = dataById['total_balance_1'][year];
                const totalBalance2 = dataById['total_balance_2'][year];
                if (Math.abs(totalBalance1 - totalBalance2) > 0.01) {
                    warnings.push({
                        year,
                        message: `<li><b>${year}</b>: <strong>‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô (1)</strong> ‡πÑ‡∏°‡πà‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö <strong>‡∏£‡∏ß‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏¥‡πâ‡∏ô (2)</strong>. 
                                  <u>‡∏ú‡∏•‡∏ï‡πà‡∏≤‡∏á</u>: <span style="font-weight: bold;">${(totalBalance1 - totalBalance2).toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</span></li>`
                    });
                    ['total_balance_1', 'total_balance_2'].forEach(id => {
                        const cell = document.querySelector(`tr[data-id='${id}'] td[data-year='${year}']`);
                        if (cell) cell.classList.add('cell-warning');
                    });
                }
            });


            if (errors.length === 0 && warnings.length === 0) {
                reportContent.innerHTML = `<div class="report-item report-success">‚úîÔ∏è ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</div>`;
                reportContainer.style.display = 'block';
            } else {
                let html = '';
                if (warnings.length > 0) {
                    html += `<div class="report-item report-warning"><h3>‚ö†Ô∏è ‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3><ul>${warnings.map(e => e.message).join('')}</ul></div>`;
                }
                if (errors.length > 0) {
                    html += `<div class="report-item report-error"><h3>üö´ ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3><ul>${errors.map(e => e.message).join('')}</ul></div>`;
                }
                reportContent.innerHTML = html;
                reportContainer.style.display = 'block';

                errors.forEach(error => {
                    const cell = document.querySelector(`tr[data-id='${error.itemId}'] td[data-year='${error.year}']`);
                    if (cell) cell.classList.add('cell-error');
                });
            }
        }



        function downloadTemplate() {
            const wsData = [["‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£", ...years]];
            tableStructure.forEach(item => wsData.push([item.name]));
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(wsData);
            XLSX.utils.book_append_sheet(wb, ws, "FinancialPlan");
            XLSX.writeFile(wb, "Template_Financial_Plan.xlsx");
        }

        function toggleEditMode(forceExit = false) {
            const btn = document.getElementById('editDataBtn');
            isEditMode = !isEditMode;

            if (forceExit) {
                isEditMode = false;
                hasUnsavedChanges = false;
            }

            if (isEditMode) {
                // Enter Edit Mode
                btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-save"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•`;
                btn.classList.add('btn-success');
                btn.classList.add('floating-save-btn');

                tableStructure.forEach(item => {
                    if (item.isEditable) {
                        const row = document.querySelector(`#tableBody tr[data-id='${item.id}']`);
                        if (row) {
                            row.querySelectorAll('td[data-year]').forEach(cell => {
                                cell.setAttribute('contenteditable', 'true');
                            });
                        }
                    }
                });
                document.getElementById('tableBody').classList.remove('chart-active');
            } else {
                // Exit Edit Mode
                btn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•`;
                btn.classList.remove('btn-success');
                btn.classList.remove('floating-save-btn');

                document.querySelectorAll('td[contenteditable="true"]').forEach(cell => {
                    cell.setAttribute('contenteditable', 'false');
                });
                document.querySelectorAll('.cell-modified').forEach(cell => {
                    cell.classList.remove('cell-modified');
                });
                document.getElementById('tableBody').classList.add('chart-active');

                if (hasUnsavedChanges) {
                    recalculateAndUpdate();
                }
                hasUnsavedChanges = false;
            }
        }



        function toggleMinimize() {
            isChartMinimized = !isChartMinimized;
            const modal = document.getElementById('chartModal');
            const backdrop = document.getElementById('chartBackdrop');
            const icon = document.getElementById('minimize-icon');
            const restoreBtn = document.getElementById('restore-btn');

            if (isChartMinimized) {
                modal.classList.add('minimized');
                backdrop.classList.remove('show');
                restoreBtn.style.display = 'flex'; // Show restore button
                // Change icon to maximize
                icon.innerHTML = '<polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" y1="3" x2="14" y2="10"></line><line x1="3" y1="21" x2="10" y2="14"></line>';
            } else {
                modal.classList.remove('minimized');
                backdrop.classList.add('show');
                restoreBtn.style.display = 'none'; // Hide restore button
                // Change icon to minimize
                icon.innerHTML = '<polyline points="4 14 10 14 10 20"></polyline><polyline points="20 10 14 10 14 4"></polyline><line x1="14" y1="10" x2="21" y2="3"></line><line x1="3" y1="21" x2="10" y2="14"></line>';
            }

            // Resize chart
            if (trendChart) {
                setTimeout(() => trendChart.resize(), 300);
            }
        }

        function closeChart() {
            const modal = document.getElementById('chartModal');
            const backdrop = document.getElementById('chartBackdrop');
            const restoreBtn = document.getElementById('restore-btn');

            modal.classList.remove('show');
            backdrop.classList.remove('show');
            restoreBtn.style.display = 'none';

            // Reset state
            isChartMinimized = false;
            modal.classList.remove('minimized');

            // Clear row highlights
            document.querySelectorAll('tr.row-active').forEach(row => row.classList.remove('row-active'));

            // Clear data
            activeDatasets = [];
            updateActiveSeriesUI();

            if (trendChart) {
                trendChart.destroy();
                trendChart = null;
            }
        }

        function removeSeries(index) {
            const removed = activeDatasets.splice(index, 1)[0];

            // Remove highlight from row
            if (removed) {
                const rows = document.querySelectorAll('#tableBody tr');
                rows.forEach(row => {
                    if (row.cells[0].textContent.trim() === removed.label.trim()) {
                        row.classList.remove('row-active');
                    }
                });
            }

            if (activeDatasets.length === 0) {
                closeChart();
            } else {
                updateActiveSeriesUI();
                createOrUpdateChart();
            }
        }

        function updateActiveSeriesUI() {
            const container = document.getElementById('active-series-container');
            container.innerHTML = '';

            activeDatasets.forEach((ds, index) => {
                const tag = document.createElement('div');
                tag.className = 'series-tag';
                tag.innerHTML = `
                <span style="width: 8px; height: 8px; border-radius: 50%; background-color: ${ds.borderColor}; display: inline-block;"></span>
                ${ds.label}
                <span class="series-remove" onclick="removeSeries(${index})">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </span>
            `;
                container.appendChild(tag);
            });
        }

        function showAggregateChart(type) {
            if (isEditMode) return;
            const sumGroup = type === 'revenue' ? 'total_revenue' : 'total_expense';
            const chartTitle = type === 'revenue' ? '‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö' : '‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏à‡πà‡∏≤‡∏¢';

            closeChart();
            document.getElementById('chart-title').textContent = chartTitle;

            const itemsToShow = tableStructure.filter(item =>
                item.sumGroup && item.sumGroup.includes(sumGroup) && !item.totalFor
            );

            itemsToShow.forEach(item => {
                const rowElement = document.querySelector(`tr[data-id='${item.id}']`);
                if (rowElement) showTrendChart(rowElement, false);
            });

            document.getElementById('stackChartToggle').checked = true;

            const modal = document.getElementById('chartModal');
            const backdrop = document.getElementById('chartBackdrop');
            modal.classList.add('show');
            if (!isChartMinimized) {
                backdrop.classList.add('show');
            }
            createOrUpdateChart();
        }

        function showTrendChart(rowElement, shouldToggle = true) {
            if (isEditMode && shouldToggle) return;

            const rowData = [];
            const cells = rowElement.querySelectorAll('td[data-year]');
            if (cells.length === 0) return;

            let hasData = false;
            cells.forEach(cell => {
                const value = parseFloatFromStr(cell.dataset.originalValue);
                if (value !== 0) hasData = true;
                rowData.push(value);
            });

            const rowId = rowElement.dataset.id;
            const itemInfo = tableStructure.find(i => i.id === rowId);
            if (!hasData || (itemInfo && itemInfo.isHeader)) {
                return;
            }

            const itemName = rowElement.cells[0].textContent;
            const existingIndex = activeDatasets.findIndex(ds => ds.label.trim() === itemName.trim());

            if (shouldToggle && existingIndex !== -1) {
                removeSeries(existingIndex);
                return;
            }
            if (!shouldToggle && existingIndex !== -1) return;

            const colorIndex = activeDatasets.length % chartColors.length;
            activeDatasets.push({
                label: itemName,
                data: rowData,
                borderColor: chartColors[colorIndex],
                backgroundColor: chartColors[colorIndex] + '33',
                fill: false,
                tension: 0.1
            });

            rowElement.classList.add('row-active');
            updateActiveSeriesUI();

            if (shouldToggle) {
                document.getElementById('chart-title').textContent = '‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏™‡∏î‡∏á‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°';
                const modal = document.getElementById('chartModal');
                const backdrop = document.getElementById('chartBackdrop');
                if (!modal.classList.contains('show')) {
                    modal.classList.add('show');
                    if (!isChartMinimized) {
                        backdrop.classList.add('show');
                    }
                }
                createOrUpdateChart();
            }
        }

        function updateChart() {
            if (activeDatasets.length > 0) {
                createOrUpdateChart();
            }
        }

        function createOrUpdateChart() {
            const showPercentage = document.getElementById('showPercentageToggle').checked;
            const ctx = document.getElementById('trendChart').getContext('2d');

            if (trendChart) {
                trendChart.destroy();
            }

            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: activeDatasets
                },
                plugins: [ChartDataLabels],
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function (value) {
                                    const isFormattingToggled = document.getElementById('formatNumberToggle').checked;
                                    return formatNumber(value, isFormattingToggled);
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        datalabels: {
                            display: showPercentage,
                            align: 'top',
                            color: '#333',
                            font: { weight: 'bold' },
                            formatter: (value, context) => {
                                if (context.dataIndex === 0) return null;
                                const prevValue = context.dataset.data[context.dataIndex - 1];
                                if (prevValue === 0) return 'N/A';
                                const percentageChange = ((value - prevValue) / prevValue) * 100;
                                return (percentageChange >= 0 ? '+' : '') + percentageChange.toFixed(1) + '%';
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    let label = context.dataset.label || '';
                                    if (label) label += ': ';
                                    if (context.parsed.y !== null) {
                                        label += context.parsed.y.toLocaleString('th-TH', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                                    }
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }


        let isAnalysisVisible = false;
        function analyzePlan() {
            isAnalysisVisible = !isAnalysisVisible;

            const analysisHeader = "‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå";
            const thead = document.querySelector('#dataTable thead tr');
            const headerCell = Array.from(thead.querySelectorAll('th')).find(th => th.textContent === analysisHeader);

            if (isAnalysisVisible) {
                // SHOW ANALYSIS
                if (!headerCell) {
                    const analysisTh = document.createElement('th');
                    analysisTh.textContent = analysisHeader;
                    thead.appendChild(analysisTh);
                }

                const itemsToAnalyze = [
                    "rev_uc", "rev_uc_invest", "rev_ems", "rev_direct_claim", "rev_reimburse", 
                    "rev_local_gov", "rev_social_security", "rev_foreign_worker", "rev_other_service",
                    "rev_aid", "rev_subsidy", "rev_donation", "rev_interest", "rev_other", "total_revenue",
                    "exp_temp_employee", "exp_ot_service", "exp_night_shift", "exp_no_private_practice",
                    "exp_allowance_11", "exp_performance_12", "exp_pts", "exp_ot_5", "exp_smc", 
                    "exp_other_comp", "exp_other_personnel", "exp_allowance_10", "exp_medicine",
                    "exp_non_medicine_supplies", "exp_medical_supplies", "exp_lab_supplies", "exp_pharma_supplies",
                    "exp_dental_supplies", "exp_xray_supplies", "exp_materials", "exp_utilities", "exp_sundry",
                    "exp_other_op", "exp_equip_depreciation", "exp_equip_donation", "exp_equip_maintenance",
                    "exp_lb_depreciation", "exp_lb_donation", "exp_lb_maintenance", "exp_support_other_hospitals",
                    "exp_misc", "exp_central_fund"
                ];

                const relevantYears = years.slice(-4); 

                document.querySelectorAll('#tableBody tr').forEach(tr => {
                    const itemId = tr.dataset.id;
                    
                    let analysisTd = tr.querySelector('.analysis-cell');
                    if (!analysisTd) {
                        analysisTd = document.createElement('td');
                        analysisTd.className = 'analysis-cell';
                        tr.appendChild(analysisTd);
                    }
                    analysisTd.textContent = ''; 

                    tr.querySelectorAll('.cell-analysis-warning').forEach(cell => {
                        cell.classList.remove('cell-analysis-warning');
                    });

                    if (itemsToAnalyze.includes(itemId)) {
                        const yearValues = {};
                        tr.querySelectorAll('td[data-year]').forEach(cell => {
                            yearValues[cell.dataset.year] = parseFloatFromStr(cell.dataset.originalValue);
                        });

                        let analysisMessages = [];

                        for (let i = 1; i < relevantYears.length; i++) {
                            const prevYear = relevantYears[i-1];
                            const currentYear = relevantYears[i];
                            
                            const prevValue = yearValues[prevYear];
                            const currentValue = yearValues[currentYear];

                            if (prevValue !== 0) {
                                const percentageChange = ((currentValue - prevValue) / prevValue) * 100;
                                let message = '';
                                
                                if (percentageChange > 10) { // Report if increase > 10%
                                    const cellToHighlight = tr.querySelector(`td[data-year='${currentYear}']`);
                                    if (cellToHighlight) {
                                        cellToHighlight.classList.add('cell-analysis-warning');
                                    }

                                    if (percentageChange > 100) {
                                        message = `‡∏õ‡∏µ ${currentYear} ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏≤‡∏Å (${percentageChange.toFixed(2)}%)`; // Greatly increased
                                    } else if (percentageChange > 50) {
                                        message = `‡∏õ‡∏µ ${currentYear} ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (${percentageChange.toFixed(2)}%)`; // Moderately increased
                                    } else { // 10% - 50%
                                        message = `‡∏õ‡∏µ ${currentYear} ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ (${percentageChange.toFixed(2)}%)`; // Slightly increased
                                    }
                                    analysisMessages.push(message);
                                } else if (percentageChange < -10) { // Report if decrease > 10% (absolute value)
                                     const cellToHighlight = tr.querySelector(`td[data-year='${currentYear}']`);
                                    if (cellToHighlight) {
                                        cellToHighlight.classList.add('cell-analysis-warning');
                                    }
                                    message = `‡∏õ‡∏µ ${currentYear} ‡∏•‡∏î‡∏•‡∏á (${Math.abs(percentageChange).toFixed(2)}%)`;
                                    analysisMessages.push(message);
                                }
                            } else if (currentValue > 0) { // Case: increased from 0
                                const cellToHighlight = tr.querySelector(`td[data-year='${currentYear}']`);
                                if (cellToHighlight) {
                                    cellToHighlight.classList.add('cell-analysis-warning');
                                }
                                analysisMessages.push(`‡∏õ‡∏µ ${currentYear} ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏à‡∏≤‡∏Å 0`);
                            }
                        }
                        
                        if (analysisMessages.length > 0) {
                            analysisTd.textContent = analysisMessages.join(', ');
                        }
                    }
                });

            } else {
                // HIDE ANALYSIS
                if (headerCell) {
                    headerCell.remove();
                }

                document.querySelectorAll('#tableBody tr').forEach(tr => {
                    const analysisCell = tr.querySelector('.analysis-cell');
                    if (analysisCell) {
                        analysisCell.remove();
                    }
                    tr.querySelectorAll('.cell-analysis-warning').forEach(cell => {
                        cell.classList.remove('cell-analysis-warning');
                    });
                });
            }
        }

        initTable();



        document.addEventListener('DOMContentLoaded', (event) => {

            const table = document.getElementById('dataTable');
            if (!table) return;

            const tableBody = table.querySelector('#tableBody');
            const thead = table.querySelector('thead');
            const tableContainer = document.querySelector('.table-container');

            // --- Event delegation for editing ---
            tableBody.addEventListener('input', function (e) {
                if (isEditMode && e.target.isContentEditable) {
                    const cell = e.target;
                    const newValue = parseFloatFromStr(cell.textContent);
                    cell.dataset.originalValue = isNaN(newValue) ? 0 : newValue;
                    cell.classList.add('cell-modified');
                    recalculateAndUpdate();
                }
            });


            let placeholder = null;
            window.addEventListener('scroll', function () {
                const containerRect = tableContainer.getBoundingClientRect();
                if (containerRect.top < 0) {
                    if (!thead.classList.contains('header-fixed')) {
                        if (!placeholder) {
                            placeholder = document.createElement('div');
                            placeholder.style.height = `${thead.offsetHeight}px`;
                            table.parentNode.insertBefore(placeholder, table);
                        }
                        const firstRowTds = table.querySelector('tbody tr:first-child');
                        if (firstRowTds) {
                            const ths = thead.querySelectorAll('th');
                            const tds = firstRowTds.querySelectorAll('td');
                            ths.forEach((th, i) => {
                                if (tds[i]) { th.style.width = `${tds[i].offsetWidth}px`; }
                            });
                        }
                        thead.classList.add('header-fixed');
                        thead.style.width = `${tableContainer.offsetWidth}px`;
                    }
                } else {
                    if (thead.classList.contains('header-fixed')) {
                        thead.classList.remove('header-fixed');
                        thead.querySelectorAll('th').forEach(th => th.style.width = '');
                        thead.style.width = '';
                        if (placeholder) {
                            placeholder.remove();
                            placeholder = null;
                        }
                    }
                }
            });

            tableBody.addEventListener('click', function (e) {
                const row = e.target.closest('tr.clickable-row');
                if (row) {
                    showTrendChart(row);
                }
            });

            const chartBackdrop = document.getElementById('chartBackdrop');
            chartBackdrop.addEventListener('click', function () {
                toggleMinimize();
            });
        });

    </script>



</body>

</html>
