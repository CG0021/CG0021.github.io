<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡πÅ‡∏≠‡∏û‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ - ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</title>
    <script src="https://cdn.jsdelivr.net/npm/quagga@0.12.1/dist/quagga.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Sarabun', -apple-system, BlinkMacSystemFont, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background-color: #f5f5f5;
            padding: 0;
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            background-color: white;
            min-height: 100vh;
            padding: 15px;
            padding-bottom: 80px; /* Space for bottom navigation */
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 15px;
            font-size: 1.4em;
            padding: 10px 0;
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border-radius: 10px;
            margin-top: 0;
        }
        
        .mobile-tabs {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            border-top: 1px solid #ddd;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
        
        .mobile-tab {
            flex: 1;
            padding: 12px 5px;
            text-align: center;
            cursor: pointer;
            font-size: 0.8em;
            color: #666;
            border: none;
            background: white;
            transition: all 0.3s;
        }
        
        .mobile-tab.active {
            color: #4CAF50;
            font-weight: bold;
        }
        
        .mobile-tab i {
            display: block;
            font-size: 1.4em;
            margin-bottom: 4px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .scanner-container {
            position: relative;
            width: 100%;
            height: 40vh;
            margin-bottom: 15px;
            border: 2px dashed #ccc;
            border-radius: 12px;
            overflow: hidden;
            background: #000;
        }
        
        #scanner {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .scanner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background-color: rgba(0,0,0,0.7);
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .scanner-overlay.hidden {
            display: none;
        }
        
        .scanner-frame {
            width: 80%;
            height: 40%;
            border: 3px solid #4CAF50;
            border-radius: 10px;
            position: relative;
            margin-bottom: 20px;
        }
        
        .scanner-frame::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 2px solid rgba(255,255,255,0.5);
            border-radius: 8px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 0.3; }
            100% { opacity: 0.7; }
        }
        
        .mobile-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        button {
            padding: 14px 10px;
            border: none;
            border-radius: 8px;
            background-color: #4CAF50;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.95em;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }
        
        button:active {
            transform: scale(0.98);
        }
        
        button.secondary {
            background-color: #f44336;
        }
        
        button.info {
            background-color: #2196F3;
        }
        
        button.warning {
            background-color: #ff9800;
        }
        
        button.success {
            background-color: #4CAF50;
        }
        
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 12px;
            background-color: #f8f8f8;
            border-radius: 10px;
            font-size: 0.95em;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #4CAF50;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }
        
        .product-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }
        
        input, select {
            padding: 12px 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.95em;
            min-height: 44px; /* Better touch target */
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }
        
        .mobile-table-container {
            overflow-x: auto;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .product-list {
            width: 100%;
            border-collapse: collapse;
            min-width: 500px; /* Ensure table doesn't get too small */
        }
        
        .product-list th, .product-list td {
            border: 1px solid #ddd;
            padding: 10px 8px;
            text-align: left;
            font-size: 0.9em;
        }
        
        .product-list th {
            background-color: #f2f2f2;
            position: sticky;
            left: 0;
        }
        
        .summary {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .summary h3 {
            margin-bottom: 12px;
            font-size: 1.1em;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        
        .total {
            font-weight: bold;
            font-size: 1.1em;
            border-top: 1px solid #ddd;
            padding-top: 10px;
            margin-top: 10px;
        }
        
        .payment-section {
            background-color: #e8f5e9;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .payment-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .payment-result {
            background-color: #fff3e0;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-weight: bold;
            text-align: center;
            font-size: 0.95em;
        }
        
        .hidden {
            display: none !important;
        }
        
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            padding: 15px;
        }
        
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            max-height: 85vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5em;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .modal-form input, .modal-form select {
            padding: 14px 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }
        
        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 15px;
        }
        
        .new-product-options {
            background-color: #f8f8f8;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #2196F3;
        }
        
        .new-product-options h3 {
            margin-bottom: 10px;
            color: #2196F3;
            font-size: 1.1em;
        }
        
        .option-buttons {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }
        
        .stock-management {
            background-color: #e8f5e9;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid #4CAF50;
        }
        
        .stock-management h3 {
            margin-bottom: 10px;
            color: #2e7d32;
            font-size: 1.1em;
        }
        
        .stock-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 10px;
        }
        
        .last-scanned {
            background-color: #fff3e0;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9em;
        }
        
        .income-summary {
            background-color: #e3f2fd;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #2196F3;
        }
        
        .income-summary h3 {
            margin-bottom: 10px;
            color: #1565c0;
            font-size: 1.1em;
        }
        
        .income-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .income-stat {
            background-color: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        
        .income-stat .value {
            font-size: 1.3em;
            font-weight: bold;
            color: #2e7d32;
        }
        
        /* Mobile optimizations */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
                padding-bottom: 70px;
            }
            
            h1 {
                font-size: 1.2em;
                margin-bottom: 10px;
            }
            
            .scanner-container {
                height: 35vh;
            }
            
            .mobile-controls {
                grid-template-columns: 1fr;
            }
            
            .product-form, .stock-form, .payment-form {
                grid-template-columns: 1fr;
            }
            
            .income-stats {
                grid-template-columns: 1fr;
            }
            
            button {
                padding: 16px 10px;
                font-size: 1em;
            }
            
            .mobile-tab {
                padding: 10px 3px;
                font-size: 0.75em;
            }
            
            .mobile-tab i {
                font-size: 1.2em;
            }
        }
        
        /* Better touch targets */
        .touch-target {
            min-height: 44px;
            min-width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Swipe gestures for tabs */
        .tab-content {
            touch-action: pan-y;
        }
        
        /* Loading states */
        .loading {
            opacity: 0.7;
            pointer-events: none;
        }
        
        /* Success/error states */
        .success-message {
            background-color: #e8f5e9;
            color: #2e7d32;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }
        
        .error-message {
            background-color: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì± ‡πÅ‡∏≠‡∏û‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤ - ‡∏™‡πÅ‡∏Å‡∏ô‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î</h1>
        
        <!-- ‡πÅ‡∏ó‡πá‡∏ö‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
        <div class="tab-content active" id="sale-tab">
            <div class="scanner-container">
                <div id="scanner"></div>
                <div id="scanner-overlay" class="scanner-overlay">
                    <div class="scanner-frame"></div>
                    <p>‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á</p>
                    <p style="font-size: 0.9em; margin-top: 10px; opacity: 0.8;">‡∏ß‡∏≤‡∏á‡∏ö‡∏≤‡∏£‡πå‡πÇ‡∏Ñ‡πâ‡∏î‡πÉ‡∏ô‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πÅ‡∏Å‡∏ô</p>
                </div>
            </div>
            
            <div class="mobile-controls">
                <button id="start-button" class="success">üì∑ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô</button>
                <button id="stop-button" class="secondary">üõë ‡∏´‡∏¢‡∏∏‡∏î‡∏™‡πÅ‡∏Å‡∏ô</button>
                <button id="manual-input" class="info">‚å®Ô∏è ‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏°‡∏∑‡∏≠</button>
            </div>
            
            <!-- Toggle ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏†‡∏≤‡∏©‡∏µ -->
            <div class="toggle-container">
                <span>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏†‡∏≤‡∏©‡∏µ 7%</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="tax-toggle" checked>
                    <span class="toggle-slider"></span>
                </label>
                <span id="tax-status">‡πÄ‡∏õ‡∏¥‡∏î</span>
            </div>
            
            <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà -->
            <div id="new-product-options" class="new-product-options hidden">
                <h3>‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h3>
                <p>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: <strong id="new-product-code"></strong></p>
                <div class="option-buttons">
                    <button id="add-to-database" class="info">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</button>
                    <button id="sell-without-save">üí∞ ‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    <button id="cancel-new-product" class="secondary">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </div>
            
            <div class="product-form">
                <input type="text" id="product-code" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" readonly>
                <input type="text" id="product-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                <input type="number" id="product-price" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" min="0" step="0.01">
                <input type="number" id="product-quantity" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" min="1" value="1">
                <button id="add-product" class="success">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
            </div>
            
            <div class="mobile-table-container">
                <table class="product-list">
                    <thead>
                        <tr>
                            <th>‡∏£‡∏´‡∏±‡∏™</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                            <th>‡∏£‡∏ß‡∏°</th>
                            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="product-list-body">
                        <!-- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                    </tbody>
                </table>
            </div>
            
            <div class="summary">
                <h3>üßÆ ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏Ñ‡∏≤</h3>
                <div class="summary-item">
                    <span>‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</span>
                    <span id="subtotal">0.00</span>
                </div>
                <div class="summary-item" id="tax-item">
                    <span>‡∏†‡∏≤‡∏©‡∏µ (7%):</span>
                    <span id="tax">0.00</span>
                </div>
                <div class="summary-item total">
                    <span>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>
                    <span id="total">0.00</span>
                </div>
                
                <!-- ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
                <div class="payment-section">
                    <h3>üí≥ ‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
                    <div class="payment-form">
                        <input type="number" id="cash-received" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏°‡∏≤" min="0" step="0.01">
                        <button id="calculate-change" class="info">üîÑ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏ô</button>
                    </div>
                    <div class="payment-result" id="change-result">
                        ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏°‡∏≤
                    </div>
                    <div class="mobile-controls" style="margin-top: 15px;">
                        <button id="checkout-button" class="success">‚úÖ ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</button>
                        <button id="clear-cart" class="secondary">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ‡πÅ‡∏ó‡πá‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
        <div class="tab-content" id="database-tab">
            <div style="margin-bottom: 15px;">
                <h3 style="text-align: center; margin-bottom: 15px;">üì¶ ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                <div class="mobile-controls">
                    <button id="add-new-product" class="info">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</button>
                    <button id="scan-new-product" class="warning">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                </div>
            </div>
            
            <div class="mobile-table-container">
                <table class="product-list">
                    <thead>
                        <tr>
                            <th>‡∏£‡∏´‡∏±‡∏™</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                            <th>‡∏™‡∏ï‡πá‡∏≠‡∏Å</th>
                            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="database-list-body">
                        <!-- ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- ‡πÅ‡∏ó‡πá‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å -->
        <div class="tab-content" id="stock-tab">
            <div class="stock-management">
                <h3>üìä ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                <div class="stock-form">
                    <input type="text" id="stock-product-code" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" readonly>
                    <input type="text" id="stock-product-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" readonly>
                    <input type="number" id="stock-quantity" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô" min="1" value="1">
                    <select id="stock-action">
                        <option value="add">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å</option>
                        <option value="remove">‚ûñ ‡∏•‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å</option>
                    </select>
                    <button id="apply-stock" class="info">‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Å</button>
                </div>
                <div class="mobile-controls">
                    <button id="scan-stock" class="info">üì∑ ‡∏™‡πÅ‡∏Å‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                    <button id="manual-stock" class="warning">‚å®Ô∏è ‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏°‡∏∑‡∏≠</button>
                </div>
                <div id="last-scanned" class="last-scanned hidden">
                    <!-- ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î -->
                </div>
            </div>
            
            <h3 style="margin-bottom: 10px;">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å</h3>
            <div class="mobile-table-container">
                <table class="product-list">
                    <thead>
                        <tr>
                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                            <th>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                            <th>‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏±‡∏ö</th>
                        </tr>
                    </thead>
                    <tbody id="stock-history-body">
                        <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- ‡πÅ‡∏ó‡πá‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö -->
        <div class="tab-content" id="income-tab">
            <div class="income-summary">
                <h3>üí∞ ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</h3>
                <div class="mobile-controls">
                    <button id="today-income" class="info">üìÖ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
                    <button id="week-income" class="info">üìÖ ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ</button>
                    <button id="month-income" class="info">üìÖ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
                    <button id="all-income" class="info">üìä ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                </div>
                
                <div class="income-stats">
                    <div class="income-stat">
                        <div>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</div>
                        <div class="value" id="sales-count">0</div>
                    </div>
                    <div class="income-stat">
                        <div>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢‡∏£‡∏ß‡∏°</div>
                        <div class="value" id="total-sales">0.00</div>
                    </div>
                    <div class="income-stat">
                        <div>‡∏†‡∏≤‡∏©‡∏µ‡∏£‡∏ß‡∏°</div>
                        <div class="value" id="total-tax">0.00</div>
                    </div>
                    <div class="income-stat">
                        <div>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</div>
                        <div class="value" id="net-income">0.00</div>
                    </div>
                </div>
            </div>
            
            <h3 style="margin-bottom: 10px;">üìà ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</h3>
            <div class="mobile-table-container">
                <table class="product-list">
                    <thead>
                        <tr>
                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà/‡πÄ‡∏ß‡∏•‡∏≤</th>
                            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢</th>
                            <th>‡∏†‡∏≤‡∏©‡∏µ</th>
                            <th>‡∏£‡∏ß‡∏°</th>
                            <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody id="sales-history-body">
                        <!-- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Mobile Bottom Navigation -->
    <div class="mobile-tabs">
        <button class="mobile-tab active" data-tab="sale">
            <span>üõí</span>
            <span>‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
        </button>
        <button class="mobile-tab" data-tab="database">
            <span>üì¶</span>
            <span>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</span>
        </button>
        <button class="mobile-tab" data-tab="stock">
            <span>üìä</span>
            <span>‡∏™‡∏ï‡πá‡∏≠‡∏Å</span>
        </button>
        <button class="mobile-tab" data-tab="income">
            <span>üí∞</span>
            <span>‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</span>
        </button>
    </div>

    <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
    <div id="product-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h2>
                <button id="modal-close-btn" class="modal-close">&times;</button>
            </div>
            <div class="modal-form">
                <input type="text" id="modal-code" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                <input type="text" id="modal-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">
                <input type="number" id="modal-price" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" min="0" step="0.01">
                <input type="number" id="modal-stock" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô" min="0" value="0">
                <div class="modal-buttons">
                    <button id="modal-cancel" class="secondary">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button id="modal-save" class="success">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠ -->
    <div id="manual-input-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚å®Ô∏è ‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
                <button class="modal-close manual-close">&times;</button>
            </div>
            <div class="modal-form">
                <input type="text" id="manual-code" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤" autofocus>
                <div class="modal-buttons">
                    <button class="manual-cancel secondary">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button id="manual-confirm" class="success">‚úÖ ‡∏ï‡∏Å‡∏•‡∏á</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á
        let productDatabase = {
            '123456789012': { name: '‡∏ô‡πâ‡∏≥‡∏î‡∏∑‡πà‡∏°‡∏Ñ‡∏£‡∏¥‡∏™‡∏ï‡∏±‡∏•', price: 10.00, stock: 50 },
            '234567890123': { name: '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡∏ü‡∏≤‡∏£‡πå‡∏°‡πÄ‡∏Æ‡πâ‡∏≤‡∏™‡πå', price: 25.00, stock: 30 },
            '345678901234': { name: '‡∏ô‡∏°‡∏¢‡∏π‡πÄ‡∏≠‡∏ä‡∏ó‡∏µ', price: 15.00, stock: 40 },
            '456789012345': { name: '‡∏ö‡∏∞‡∏´‡∏°‡∏µ‡πà‡∏Å‡∏∂‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏£‡∏π‡∏õ', price: 8.00, stock: 100 },
            '567890123456': { name: '‡πÑ‡∏Ç‡πà‡πÑ‡∏Å‡πà 10 ‡∏ü‡∏≠‡∏á', price: 45.00, stock: 20 }
        };
        
        let products = [];
        let isScanning = false;
        let currentEditingCode = null;
        let currentScannedCode = null;
        let stockHistory = [];
        let salesHistory = [];
        let includeTax = true;
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå
        function startScanner() {
            const scannerOverlay = document.getElementById('scanner-overlay');
            scannerOverlay.classList.add('hidden');
            
            const config = {
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#scanner'),
                    constraints: {
                        width: 640,
                        height: 480,
                        facingMode: "environment"
                    }
                },
                locator: {
                    patchSize: "medium",
                    halfSample: true
                },
                numOfWorkers: 2,
                decoder: {
                    readers: ["ean_reader", "ean_8_reader", "code_128_reader", "upc_reader", "upc_e_reader"]
                },
                locate: true
            };
            
            Quagga.init(config, function(err) {
                if (err) {
                    console.error(err);
                    alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ: ' + err);
                    return;
                }
                Quagga.start();
                isScanning = true;
            });
            
            let lastCode = '';
            let sameCodeCount = 0;
            
            Quagga.onDetected(function(result) {
                const code = result.codeResult.code;
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡∏ã‡πâ‡∏≥)
                if (code === lastCode) {
                    sameCodeCount++;
                    if (sameCodeCount < 2) {
                        return;
                    }
                } else {
                    lastCode = code;
                    sameCodeCount = 1;
                    return;
                }
                
                // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö
                sameCodeCount = 0;
                
                processScannedCode(code);
            });
        }
        
        // ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏™‡πÅ‡∏Å‡∏ô‡πÑ‡∏î‡πâ
        function processScannedCode(code) {
            currentScannedCode = code;
            
            // ‡∏´‡∏¢‡∏∏‡∏î‡∏™‡πÅ‡∏Å‡∏ô‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
            Quagga.stop();
            isScanning = false;
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏ó‡πá‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
            const activeTab = document.querySelector('.mobile-tab.active').getAttribute('data-tab');
            
            if (activeTab === 'sale') {
                // ‡πÇ‡∏´‡∏°‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                document.getElementById('product-code').value = code;
                
                // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
                if (productDatabase[code]) {
                    const product = productDatabase[code];
                    document.getElementById('product-name').value = product.name;
                    document.getElementById('product-price').value = product.price.toFixed(2);
                    
                    // ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏´‡∏≤‡∏Å‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πà‡∏≥
                    if (product.stock <= 5) {
                        showMessage(`‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${product.name} ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏û‡∏µ‡∏¢‡∏á ${product.stock} ‡∏ä‡∏¥‡πâ‡∏ô`, 'warning');
                    }
                    
                    // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
                    document.getElementById('new-product-options').classList.add('hidden');
                    
                    // ‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
                    document.getElementById('product-quantity').focus();
                } else {
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
                    document.getElementById('new-product-code').textContent = code;
                    document.getElementById('new-product-options').classList.remove('hidden');
                    
                    // ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°
                    document.getElementById('product-name').value = '';
                    document.getElementById('product-price').value = '';
                }
            } else if (activeTab === 'stock') {
                // ‡πÇ‡∏´‡∏°‡∏î‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å
                document.getElementById('stock-product-code').value = code;
                
                if (productDatabase[code]) {
                    const product = productDatabase[code];
                    document.getElementById('stock-product-name').value = product.name;
                    document.getElementById('stock-quantity').focus();
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                    document.getElementById('last-scanned').classList.remove('hidden');
                    document.getElementById('last-scanned').innerHTML = `
                        <strong>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î:</strong> ${product.name} (${code}) - ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${product.stock} ‡∏ä‡∏¥‡πâ‡∏ô
                    `;
                } else {
                    document.getElementById('stock-product-name').value = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö';
                    document.getElementById('last-scanned').classList.remove('hidden');
                    document.getElementById('last-scanned').innerHTML = `
                        <strong>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</strong> ‡∏£‡∏´‡∏±‡∏™ ${code} ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
                    `;
                }
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå
        function stopScanner() {
            if (isScanning) {
                Quagga.stop();
                isScanning = false;
            }
            document.getElementById('scanner-overlay').classList.remove('hidden');
            document.getElementById('new-product-options').classList.add('hidden');
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        function addProduct() {
            const code = document.getElementById('product-code').value;
            const name = document.getElementById('product-name').value;
            const price = parseFloat(document.getElementById('product-price').value);
            const quantity = parseInt(document.getElementById('product-quantity').value);
            
            if (!code || !name || isNaN(price) || isNaN(quantity)) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            if (productDatabase[code] && productDatabase[code].stock < quantity) {
                showMessage(`‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${name} ‡∏°‡∏µ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠! ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${productDatabase[code].stock} ‡∏ä‡∏¥‡πâ‡∏ô`, 'error');
                return;
            }
            
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
            const product = {
                code: code,
                name: name,
                price: price,
                quantity: quantity,
                total: price * quantity
            };
            
            products.push(product);
            updateProductList();
            updateSummary();
            
            // ‡∏•‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            if (productDatabase[code]) {
                productDatabase[code].stock -= quantity;
                localStorage.setItem('productDatabase', JSON.stringify(productDatabase));
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏ï‡πá‡∏≠‡∏Å
                addStockHistory(code, name, 'sale', quantity, productDatabase[code].stock);
            }
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('product-code').value = '';
            document.getElementById('product-name').value = '';
            document.getElementById('product-price').value = '';
            document.getElementById('product-quantity').value = '1';
            
            // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
            document.getElementById('new-product-options').classList.add('hidden');
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏´‡∏°‡πà
            if (!isScanning) {
                startScanner();
            }
        }
        
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        function removeProduct(index) {
            const product = products[index];
            
            // ‡∏Ñ‡∏∑‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            if (productDatabase[product.code]) {
                productDatabase[product.code].stock += product.quantity;
                localStorage.setItem('productDatabase', JSON.stringify(productDatabase));
                
                // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏ï‡πá‡∏≠‡∏Å
                addStockHistory(product.code, product.name, 'return', product.quantity, productDatabase[product.code].stock);
            }
            
            products.splice(index, 1);
            updateProductList();
            updateSummary();
        }
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        function updateProductList() {
            const tbody = document.getElementById('product-list-body');
            tbody.innerHTML = '';
            
            products.forEach((product, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.code}</td>
                    <td>${product.name}</td>
                    <td>${product.price.toFixed(2)}</td>
                    <td>${product.quantity}</td>
                    <td>${product.total.toFixed(2)}</td>
                    <td><button onclick="removeProduct(${index})" class="secondary touch-target">üóëÔ∏è</button></td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏Ñ‡∏≤
        function updateSummary() {
            const subtotal = products.reduce((sum, product) => sum + product.total, 0);
            const tax = includeTax ? subtotal * 0.07 : 0;
            const total = subtotal + tax;
            
            document.getElementById('subtotal').textContent = subtotal.toFixed(2);
            document.getElementById('tax').textContent = tax.toFixed(2);
            document.getElementById('total').textContent = total.toFixed(2);
            
            // ‡πÅ‡∏™‡∏î‡∏á/‡∏ã‡πà‡∏≠‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏©‡∏µ
            document.getElementById('tax-item').style.display = includeTax ? 'flex' : 'none';
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏ô
            calculateChange();
        }
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏ô
        function calculateChange() {
            const cashReceived = parseFloat(document.getElementById('cash-received').value) || 0;
            const total = parseFloat(document.getElementById('total').textContent) || 0;
            
            if (cashReceived === 0) {
                document.getElementById('change-result').textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏°‡∏≤';
                document.getElementById('change-result').style.backgroundColor = '#fff3e0';
                document.getElementById('change-result').style.color = 'inherit';
                return;
            }
            
            if (cashReceived < total) {
                document.getElementById('change-result').textContent = `‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏û‡∏≠! ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏µ‡∏Å ${(total - cashReceived).toFixed(2)} ‡∏ö‡∏≤‡∏ó`;
                document.getElementById('change-result').style.backgroundColor = '#ffebee';
                document.getElementById('change-result').style.color = '#c62828';
            } else {
                const change = cashReceived - total;
                document.getElementById('change-result').textContent = `‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏ô: ${change.toFixed(2)} ‡∏ö‡∏≤‡∏ó`;
                document.getElementById('change-result').style.backgroundColor = '#e8f5e9';
                document.getElementById('change-result').style.color = '#2e7d32';
            }
        }
        
        // ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
        function checkout() {
            if (products.length === 0) {
                showMessage('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£', 'error');
                return;
            }
            
            const cashReceived = parseFloat(document.getElementById('cash-received').value) || 0;
            const total = parseFloat(document.getElementById('total').textContent) || 0;
            
            if (cashReceived < total) {
                showMessage('‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏°‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°', 'error');
                return;
            }
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
            const saleRecord = {
                id: Date.now(),
                date: new Date().toLocaleString('th-TH'),
                products: [...products],
                subtotal: parseFloat(document.getElementById('subtotal').textContent),
                tax: parseFloat(document.getElementById('tax').textContent),
                total: total,
                cashReceived: cashReceived,
                change: cashReceived - total
            };
            
            salesHistory.unshift(saleRecord);
            localStorage.setItem('salesHistory', JSON.stringify(salesHistory));
            
            const change = cashReceived - total;
            showMessage(`‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏≠‡∏ô: ${change.toFixed(2)} ‡∏ö‡∏≤‡∏ó`, 'success');
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
            products = [];
            updateProductList();
            updateSummary();
            document.getElementById('cash-received').value = '';
            document.getElementById('change-result').textContent = '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡∏°‡∏≤';
            document.getElementById('change-result').style.backgroundColor = '#fff3e0';
            document.getElementById('change-result').style.color = 'inherit';
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö
            updateIncomeSummary();
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏´‡∏°‡πà
            startScanner();
        }
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        function showMessage(message, type) {
            // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Å‡πà‡∏≤‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            const existingMessage = document.querySelector('.success-message, .error-message');
            if (existingMessage) {
                existingMessage.remove();
            }
            
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.textContent = message;
            
            // ‡πÅ‡∏ó‡∏£‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡∏Ç‡∏≠‡∏á container
            const container = document.querySelector('.container');
            container.insertBefore(messageDiv, container.firstChild);
            
            // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        function updateDatabaseList() {
            const tbody = document.getElementById('database-list-body');
            tbody.innerHTML = '';
            
            Object.keys(productDatabase).forEach(code => {
                const product = productDatabase[code];
                const stockClass = product.stock === 0 ? 'stock-out' : (product.stock <= 5 ? 'stock-low' : '');
                
                const row = document.createElement('tr');
                row.className = stockClass;
                row.innerHTML = `
                    <td>${code}</td>
                    <td>${product.name}</td>
                    <td>${product.price.toFixed(2)}</td>
                    <td>${product.stock}</td>
                    <td>
                        <button onclick="editProduct('${code}')" class="info touch-target">‚úèÔ∏è</button>
                        <button onclick="deleteProduct('${code}')" class="secondary touch-target">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // ‡πÄ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        function openProductModal(code = '') {
            const modal = document.getElementById('product-modal');
            const title = document.getElementById('modal-title');
            
            if (code && productDatabase[code]) {
                // ‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                title.textContent = '‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤';
                currentEditingCode = code;
                document.getElementById('modal-code').value = code;
                document.getElementById('modal-code').readOnly = true;
                document.getElementById('modal-name').value = productDatabase[code].name;
                document.getElementById('modal-price').value = productDatabase[code].price;
                document.getElementById('modal-stock').value = productDatabase[code].stock;
            } else {
                // ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà
                title.textContent = '‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà';
                currentEditingCode = null;
                document.getElementById('modal-code').value = code;
                document.getElementById('modal-code').readOnly = false;
                document.getElementById('modal-name').value = '';
                document.getElementById('modal-price').value = '';
                document.getElementById('modal-stock').value = '0';
            }
            
            modal.classList.remove('hidden');
        }
        
        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function saveProduct() {
            const code = document.getElementById('modal-code').value;
            const name = document.getElementById('modal-name').value;
            const price = parseFloat(document.getElementById('modal-price').value);
            const stock = parseInt(document.getElementById('modal-stock').value);
            
            if (!code || !name || isNaN(price) || isNaN(stock)) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            productDatabase[code] = { name, price, stock };
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage
            localStorage.setItem('productDatabase', JSON.stringify(productDatabase));
            
            // ‡∏õ‡∏¥‡∏î modal
            closeModal();
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            updateDatabaseList();
            
            showMessage('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            
            // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            if (document.querySelector('.mobile-tab.active').getAttribute('data-tab') === 'sale') {
                document.getElementById('product-code').value = code;
                document.getElementById('product-name').value = name;
                document.getElementById('product-price').value = price.toFixed(2);
                
                // ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
                document.getElementById('new-product-options').classList.add('hidden');
                
                // ‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏ä‡πà‡∏≠‡∏á‡∏à‡∏≥‡∏ô‡∏ß‡∏ô
                document.getElementById('product-quantity').focus();
            }
        }
        
        // ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        function editProduct(code) {
            openProductModal(code);
        }
        
        // ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        function deleteProduct(code) {
            if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ${productDatabase[code].name} (${code}) ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                delete productDatabase[code];
                
                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô localStorage
                localStorage.setItem('productDatabase', JSON.stringify(productDatabase));
                
                // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                updateDatabaseList();
                
                showMessage('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            }
        }
        
        // ‡∏õ‡∏¥‡∏î modal
        function closeModal() {
            const modal = document.getElementById('product-modal');
            modal.classList.add('hidden');
            currentEditingCode = null;
            
            // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡πÅ‡∏Å‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÇ‡∏´‡∏°‡∏î‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            if (document.querySelector('.mobile-tab.active').getAttribute('data-tab') === 'sale' && !isScanning) {
                startScanner();
            }
        }
        
        // ‡πÄ‡∏õ‡∏¥‡∏î modal ‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠
        function openManualInput() {
            document.getElementById('manual-input-modal').classList.remove('hidden');
            document.getElementById('manual-code').value = '';
            document.getElementById('manual-code').focus();
        }
        
        // ‡∏õ‡∏¥‡∏î modal ‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠
        function closeManualInput() {
            document.getElementById('manual-input-modal').classList.add('hidden');
        }
        
        // ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡πà‡∏õ‡πâ‡∏≠‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏°‡∏∑‡∏≠
        function processManualCode() {
            const code = document.getElementById('manual-code').value.trim();
            if (code) {
                closeManualInput();
                processScannedCode(code);
            }
        }
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏ï‡πá‡∏≠‡∏Å
        function addStockHistory(code, name, type, quantity, newStock) {
            const history = {
                date: new Date().toLocaleString('th-TH'),
                code: code,
                name: name,
                type: type,
                quantity: quantity,
                newStock: newStock
            };
            
            stockHistory.unshift(history);
            localStorage.setItem('stockHistory', JSON.stringify(stockHistory));
            updateStockHistory();
        }
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏ï‡πá‡∏≠‡∏Å
        function updateStockHistory() {
            const tbody = document.getElementById('stock-history-body');
            tbody.innerHTML = '';
            
            stockHistory.forEach(history => {
                const row = document.createElement('tr');
                const typeText = history.type === 'add' ? '‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤' : 
                               history.type === 'remove' ? '‡∏à‡πà‡∏≤‡∏¢‡∏≠‡∏≠‡∏Å' :
                               history.type === 'sale' ? '‡∏Ç‡∏≤‡∏¢' : '‡∏Ñ‡∏∑‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤';
                
                row.innerHTML = `
                    <td>${history.date}</td>
                    <td>${history.code}</td>
                    <td>${history.name}</td>
                    <td>${typeText}</td>
                    <td>${history.quantity}</td>
                    <td>${history.newStock}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
        function updateStock() {
            const code = document.getElementById('stock-product-code').value;
            const quantity = parseInt(document.getElementById('stock-quantity').value);
            const action = document.getElementById('stock-action').value;
            
            if (!code || isNaN(quantity)) {
                showMessage('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô', 'error');
                return;
            }
            
            if (!productDatabase[code]) {
                showMessage('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'error');
                return;
            }
            
            const product = productDatabase[code];
            let newStock = product.stock;
            
            if (action === 'add') {
                newStock += quantity;
            } else {
                if (product.stock < quantity) {
                    showMessage(`‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠! ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${product.stock} ‡∏ä‡∏¥‡πâ‡∏ô`, 'error');
                    return;
                }
                newStock -= quantity;
            }
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏™‡∏ï‡πá‡∏≠‡∏Å
            productDatabase[code].stock = newStock;
            localStorage.setItem('productDatabase', JSON.stringify(productDatabase));
            
            // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
            addStockHistory(code, product.name, action, quantity, newStock);
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            updateDatabaseList();
            
            // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('stock-product-code').value = '';
            document.getElementById('stock-product-name').value = '';
            document.getElementById('stock-quantity').value = '1';
            document.getElementById('last-scanned').classList.add('hidden');
            
            showMessage(`‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà: ${newStock} ‡∏ä‡∏¥‡πâ‡∏ô`, 'success');
        }
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö
        function updateIncomeSummary(period = 'all') {
            let filteredSales = [];
            const now = new Date();
            
            if (period === 'today') {
                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                filteredSales = salesHistory.filter(sale => new Date(sale.id) >= today);
            } else if (period === 'week') {
                const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                filteredSales = salesHistory.filter(sale => new Date(sale.id) >= weekAgo);
            } else if (period === 'month') {
                const monthAgo = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
                filteredSales = salesHistory.filter(sale => new Date(sale.id) >= monthAgo);
            } else {
                filteredSales = salesHistory;
            }
            
            const salesCount = filteredSales.length;
            const totalSales = filteredSales.reduce((sum, sale) => sum + sale.subtotal, 0);
            const totalTax = filteredSales.reduce((sum, sale) => sum + sale.tax, 0);
            const netIncome = filteredSales.reduce((sum, sale) => sum + sale.total, 0);
            
            document.getElementById('sales-count').textContent = salesCount;
            document.getElementById('total-sales').textContent = totalSales.toFixed(2);
            document.getElementById('total-tax').textContent = totalTax.toFixed(2);
            document.getElementById('net-income').textContent = netIncome.toFixed(2);
            
            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
            updateSalesHistory(filteredSales);
        }
        
        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
        function updateSalesHistory(sales = salesHistory) {
            const tbody = document.getElementById('sales-history-body');
            tbody.innerHTML = '';
            
            sales.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sale.date}</td>
                    <td>${sale.products.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</td>
                    <td>${sale.subtotal.toFixed(2)}</td>
                    <td>${sale.tax.toFixed(2)}</td>
                    <td>${sale.total.toFixed(2)}</td>
                    <td>
                        <button onclick="viewSaleDetail(${sale.id})" class="info touch-target">üëÅÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢
        function viewSaleDetail(saleId) {
            const sale = salesHistory.find(s => s.id === saleId);
            if (sale) {
                const detail = sale.products.map(p => `${p.name} x${p.quantity} = ${p.total.toFixed(2)}`).join('\n');
                alert(`‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢\n‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${sale.date}\n\n${detail}\n\n‡∏£‡∏ß‡∏°: ${sale.total.toFixed(2)} ‡∏ö‡∏≤‡∏ó`);
            }
        }
        
        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage
        function loadData() {
            const savedDatabase = localStorage.getItem('productDatabase');
            if (savedDatabase) {
                productDatabase = JSON.parse(savedDatabase);
            }
            
            const savedHistory = localStorage.getItem('stockHistory');
            if (savedHistory) {
                stockHistory = JSON.parse(savedHistory);
            }
            
            const savedSales = localStorage.getItem('salesHistory');
            if (savedSales) {
                salesHistory = JSON.parse(savedSales);
            }
            
            updateDatabaseList();
            updateStockHistory();
            updateIncomeSummary();
        }
        
        // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ event listeners ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à
        document.addEventListener('DOMContentLoaded', function() {
            // Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ
            document.getElementById('start-button').addEventListener('click', startScanner);
            document.getElementById('stop-button').addEventListener('click', stopScanner);
            document.getElementById('add-product').addEventListener('click', addProduct);
            document.getElementById('add-new-product').addEventListener('click', function() {
                openProductModal();
            });
            document.getElementById('scan-new-product').addEventListener('click', function() {
                stopScanner();
                startScanner();
            });
            
            // Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
            document.getElementById('add-to-database').addEventListener('click', function() {
                openProductModal(currentScannedCode);
            });
            
            document.getElementById('sell-without-save').addEventListener('click', function() {
                document.getElementById('product-name').value = '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß';
                document.getElementById('product-price').value = '0';
                document.getElementById('new-product-options').classList.add('hidden');
                document.getElementById('product-price').focus();
            });
            
            document.getElementById('cancel-new-product').addEventListener('click', function() {
                document.getElementById('product-code').value = '';
                document.getElementById('new-product-options').classList.add('hidden');
                startScanner();
            });
            
            // Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö modal
            document.getElementById('modal-save').addEventListener('click', saveProduct);
            document.getElementById('modal-cancel').addEventListener('click', closeModal);
            document.getElementById('modal-close-btn').addEventListener('click', closeModal);
            
            // Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡πâ‡∏≠‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏°‡∏∑‡∏≠
            document.getElementById('manual-input').addEventListener('click', openManualInput);
            document.getElementById('manual-confirm').addEventListener('click', processManualCode);
            document.querySelectorAll('.manual-close, .manual-cancel').forEach(btn => {
                btn.addEventListener('click', closeManualInput);
            });
            
            // Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å
            document.getElementById('scan-stock').addEventListener('click', function() {
                stopScanner();
                startScanner();
            });
            document.getElementById('manual-stock').addEventListener('click', function() {
                openManualInput();
            });
            document.getElementById('apply-stock').addEventListener('click', updateStock);
            
            // Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
            document.getElementById('checkout-button').addEventListener('click', checkout);
            document.getElementById('calculate-change').addEventListener('click', calculateChange);
            document.getElementById('cash-received').addEventListener('input', calculateChange);
            document.getElementById('clear-cart').addEventListener('click', function() {
                if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                    products = [];
                    updateProductList();
                    updateSummary();
                }
            });
            
            // Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Toggle ‡∏†‡∏≤‡∏©‡∏µ
            document.getElementById('tax-toggle').addEventListener('change', function() {
                includeTax = this.checked;
                document.getElementById('tax-status').textContent = includeTax ? '‡πÄ‡∏õ‡∏¥‡∏î' : '‡∏õ‡∏¥‡∏î';
                updateSummary();
            });
            
            // Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö
            document.getElementById('today-income').addEventListener('click', function() {
                updateIncomeSummary('today');
            });
            document.getElementById('week-income').addEventListener('click', function() {
                updateIncomeSummary('week');
            });
            document.getElementById('month-income').addEventListener('click', function() {
                updateIncomeSummary('month');
            });
            document.getElementById('all-income').addEventListener('click', function() {
                updateIncomeSummary('all');
            });
            
            // Event listeners ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Mobile Navigation
            document.querySelectorAll('.mobile-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    // ‡∏´‡∏¢‡∏∏‡∏î‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏ó‡πá‡∏ö
                    stopScanner();
                    
                    // ‡∏•‡∏ö‡∏Ñ‡∏•‡∏≤‡∏™ active ‡∏à‡∏≤‡∏Å‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    document.querySelectorAll('.mobile-tab').forEach(t => t.classList.remove('active'));
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏•‡∏≤‡∏™ active ‡πÉ‡∏´‡πâ‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡∏Ñ‡∏•‡∏¥‡∏Å
                    this.classList.add('active');
                    
                    // ‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÅ‡∏ó‡πá‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏ö‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö
                    if (tabId === 'income') {
                        updateIncomeSummary();
                    }
                    
                    // Scroll to top
                    window.scrollTo(0, 0);
                });
            });
            
            // ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà modal
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        if (this.id === 'product-modal') {
                            closeModal();
                        } else if (this.id === 'manual-input-modal') {
                            closeManualInput();
                        }
                    }
                });
            });
            
            // ‡∏õ‡∏¥‡∏î modal ‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏∏‡πà‡∏° ESC
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (!document.getElementById('product-modal').classList.contains('hidden')) {
                        closeModal();
                    }
                    if (!document.getElementById('manual-input-modal').classList.contains('hidden')) {
                        closeManualInput();
                    }
                }
            });
            
            // Prevent zoom on double tap
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
            
            // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            loadData();
        });
    </script>
</body>
</html>
